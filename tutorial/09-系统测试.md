# ç¬¬9ç« ï¼šç³»ç»Ÿæµ‹è¯•

æœ¬ç« å°†è¯¦ç»†ä»‹ç»å¦‚ä½•å¯¹Goå­¦ç”Ÿç®¡ç†ç³»ç»Ÿè¿›è¡Œå…¨é¢çš„æµ‹è¯•ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€APIæµ‹è¯•ã€å‰ç«¯æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ã€‚

## 9.1 æµ‹è¯•ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”

æˆ‘ä»¬é‡‡ç”¨ç»å…¸çš„æµ‹è¯•é‡‘å­—å¡”ç­–ç•¥ï¼š

```
    /\     E2Eæµ‹è¯• (å°‘é‡)
   /  \    
  /____\   é›†æˆæµ‹è¯• (é€‚é‡)
 /______\  
/__________\ å•å…ƒæµ‹è¯• (å¤§é‡)
```

### æµ‹è¯•ç±»å‹

1. **å•å…ƒæµ‹è¯•** - æµ‹è¯•å•ä¸ªå‡½æ•°æˆ–æ–¹æ³•
2. **é›†æˆæµ‹è¯•** - æµ‹è¯•ç»„ä»¶é—´çš„äº¤äº’
3. **APIæµ‹è¯•** - æµ‹è¯•HTTPæ¥å£
4. **å‰ç«¯æµ‹è¯•** - æµ‹è¯•ç”¨æˆ·ç•Œé¢
5. **ç«¯åˆ°ç«¯æµ‹è¯•** - æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·æµç¨‹
6. **æ€§èƒ½æµ‹è¯•** - æµ‹è¯•ç³»ç»Ÿæ€§èƒ½
7. **å®‰å…¨æµ‹è¯•** - æµ‹è¯•å®‰å…¨æ¼æ´

### æµ‹è¯•å·¥å…·

- ğŸ§ª **Go Testing** - Goå†…ç½®æµ‹è¯•æ¡†æ¶
- ğŸ”§ **Testify** - æ–­è¨€å’Œæ¨¡æ‹Ÿåº“
- ğŸŒ **Gin Test** - HTTPæµ‹è¯•å·¥å…·
- ğŸ“Š **GoConvey** - BDDæµ‹è¯•æ¡†æ¶
- ğŸš€ **Postman** - APIæµ‹è¯•å·¥å…·
- ğŸ­ **Playwright** - ç«¯åˆ°ç«¯æµ‹è¯•
- ğŸ“ˆ **Apache Bench** - æ€§èƒ½æµ‹è¯•

## 9.2 é¡¹ç›®æµ‹è¯•ç»“æ„

### æµ‹è¯•ç›®å½•ç»“æ„

```
student-management/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/              # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”œâ”€â”€ integration/       # é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ database/
â”‚   â”œâ”€â”€ e2e/              # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ specs/
â”‚   â”‚   â””â”€â”€ fixtures/
â”‚   â”œâ”€â”€ performance/       # æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ security/         # å®‰å…¨æµ‹è¯•
â”‚   â””â”€â”€ testdata/         # æµ‹è¯•æ•°æ®
â”œâ”€â”€ mocks/                # æ¨¡æ‹Ÿå¯¹è±¡
â””â”€â”€ coverage/             # è¦†ç›–ç‡æŠ¥å‘Š
```

### æµ‹è¯•é…ç½®

**æ–‡ä»¶è·¯å¾„ï¼š** `tests/config/test_config.go`

```go
package config

import (
	"os"
	"path/filepath"
	"runtime"
)

// TestConfig æµ‹è¯•é…ç½®
type TestConfig struct {
	DatabaseURL    string
	TestDataPath   string
	FixturesPath   string
	TempDir        string
	LogLevel       string
	Timeout        int
	CleanupEnabled bool
}

// GetTestConfig è·å–æµ‹è¯•é…ç½®
func GetTestConfig() *TestConfig {
	_, filename, _, _ := runtime.Caller(0)
	projectRoot := filepath.Dir(filepath.Dir(filepath.Dir(filename)))
	
	return &TestConfig{
		DatabaseURL:    getEnv("TEST_DATABASE_URL", ":memory:"),
		TestDataPath:   filepath.Join(projectRoot, "tests", "testdata"),
		FixturesPath:   filepath.Join(projectRoot, "tests", "fixtures"),
		TempDir:        filepath.Join(projectRoot, "tests", "temp"),
		LogLevel:       getEnv("TEST_LOG_LEVEL", "error"),
		Timeout:        30,
		CleanupEnabled: getEnv("TEST_CLEANUP", "true") == "true",
	}
}

func getEnv(key, defaultValue string) string {
	if value := os.Getenv(key); value != "" {
		return value
	}
	return defaultValue
}
```

## 9.3 å•å…ƒæµ‹è¯•

### æ¨¡å‹æµ‹è¯•

**æ–‡ä»¶è·¯å¾„ï¼š** `tests/unit/models/student_test.go`

```go
package models

import (
	"testing"
	"time"

	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/suite"
	"gorm.io/driver/sqlite"
	"gorm.io/gorm"

	"student-management/models"
)

// StudentModelTestSuite å­¦ç”Ÿæ¨¡å‹æµ‹è¯•å¥—ä»¶
type StudentModelTestSuite struct {
	suite.Suite
	db *gorm.DB
}

// SetupSuite è®¾ç½®æµ‹è¯•å¥—ä»¶
func (suite *StudentModelTestSuite) SetupSuite() {
	// ä½¿ç”¨å†…å­˜æ•°æ®åº“
	db, err := gorm.Open(sqlite.Open(":memory:"), &gorm.Config{})
	suite.Require().NoError(err)
	
	// è‡ªåŠ¨è¿ç§»
	err = db.AutoMigrate(&models.Student{})
	suite.Require().NoError(err)
	
	suite.db = db
}

// TearDownSuite æ¸…ç†æµ‹è¯•å¥—ä»¶
func (suite *StudentModelTestSuite) TearDownSuite() {
	sqlDB, _ := suite.db.DB()
	sqlDB.Close()
}

// SetupTest æ¯ä¸ªæµ‹è¯•å‰çš„è®¾ç½®
func (suite *StudentModelTestSuite) SetupTest() {
	// æ¸…ç†æ•°æ®
	suite.db.Exec("DELETE FROM students")
}

// TestStudentValidation æµ‹è¯•å­¦ç”Ÿæ•°æ®éªŒè¯
func (suite *StudentModelTestSuite) TestStudentValidation() {
	tests := []struct {
		name    string
		student models.Student
		wantErr bool
		errMsg  string
	}{
		{
			name: "æœ‰æ•ˆçš„å­¦ç”Ÿæ•°æ®",
			student: models.Student{
				Name:  "å¼ ä¸‰",
				Email: "zhangsan@example.com",
				Age:   20,
				Major: "è®¡ç®—æœºç§‘å­¦",
				Grade: "2023",
			},
			wantErr: false,
		},
		{
			name: "å§“åä¸ºç©º",
			student: models.Student{
				Name:  "",
				Email: "test@example.com",
				Age:   20,
				Major: "è®¡ç®—æœºç§‘å­¦",
				Grade: "2023",
			},
			wantErr: true,
			errMsg:  "å§“åä¸èƒ½ä¸ºç©º",
		},
		{
			name: "é‚®ç®±æ ¼å¼é”™è¯¯",
			student: models.Student{
				Name:  "æå››",
				Email: "invalid-email",
				Age:   20,
				Major: "è®¡ç®—æœºç§‘å­¦",
				Grade: "2023",
			},
			wantErr: true,
			errMsg:  "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®",
		},
		{
			name: "å¹´é¾„è¶…å‡ºèŒƒå›´",
			student: models.Student{
				Name:  "ç‹äº”",
				Email: "wangwu@example.com",
				Age:   35,
				Major: "è®¡ç®—æœºç§‘å­¦",
				Grade: "2023",
			},
			wantErr: true,
			errMsg:  "å¹´é¾„å¿…é¡»åœ¨16-30ä¹‹é—´",
		},
	}
	
	for _, tt := range tests {
		suite.Run(tt.name, func() {
			err := suite.db.Create(&tt.student).Error
			
			if tt.wantErr {
				suite.Error(err)
				suite.Contains(err.Error(), tt.errMsg)
			} else {
				suite.NoError(err)
				suite.NotZero(tt.student.ID)
			}
		})
	}
}

// TestStudentCRUD æµ‹è¯•å­¦ç”ŸCRUDæ“ä½œ
func (suite *StudentModelTestSuite) TestStudentCRUD() {
	// åˆ›å»ºå­¦ç”Ÿ
	student := models.Student{
		Name:  "æµ‹è¯•å­¦ç”Ÿ",
		Email: "test@example.com",
		Age:   20,
		Major: "è®¡ç®—æœºç§‘å­¦",
		Grade: "2023",
	}
	
	err := suite.db.Create(&student).Error
	suite.NoError(err)
	suite.NotZero(student.ID)
	
	// è¯»å–å­¦ç”Ÿ
	var foundStudent models.Student
	err = suite.db.First(&foundStudent, student.ID).Error
	suite.NoError(err)
	suite.Equal(student.Name, foundStudent.Name)
	suite.Equal(student.Email, foundStudent.Email)
	
	// æ›´æ–°å­¦ç”Ÿ
	foundStudent.Age = 21
	err = suite.db.Save(&foundStudent).Error
	suite.NoError(err)
	
	// éªŒè¯æ›´æ–°
	var updatedStudent models.Student
	err = suite.db.First(&updatedStudent, student.ID).Error
	suite.NoError(err)
	suite.Equal(21, updatedStudent.Age)
	
	// è½¯åˆ é™¤å­¦ç”Ÿ
	err = suite.db.Delete(&updatedStudent).Error
	suite.NoError(err)
	
	// éªŒè¯è½¯åˆ é™¤
	var deletedStudent models.Student
	err = suite.db.First(&deletedStudent, student.ID).Error
	suite.Error(err) // åº”è¯¥æ‰¾ä¸åˆ°è®°å½•
	
	// éªŒè¯è½¯åˆ é™¤è®°å½•ä»å­˜åœ¨
	err = suite.db.Unscoped().First(&deletedStudent, student.ID).Error
	suite.NoError(err)
	suite.NotNil(deletedStudent.DeletedAt)
}

// TestStudentUniqueConstraints æµ‹è¯•å”¯ä¸€çº¦æŸ
func (suite *StudentModelTestSuite) TestStudentUniqueConstraints() {
	// åˆ›å»ºç¬¬ä¸€ä¸ªå­¦ç”Ÿ
	student1 := models.Student{
		Name:  "å­¦ç”Ÿ1",
		Email: "duplicate@example.com",
		Age:   20,
		Major: "è®¡ç®—æœºç§‘å­¦",
		Grade: "2023",
	}
	
	err := suite.db.Create(&student1).Error
	suite.NoError(err)
	
	// å°è¯•åˆ›å»ºç›¸åŒé‚®ç®±çš„å­¦ç”Ÿ
	student2 := models.Student{
		Name:  "å­¦ç”Ÿ2",
		Email: "duplicate@example.com", // é‡å¤é‚®ç®±
		Age:   21,
		Major: "æ•°å­¦",
		Grade: "2023",
	}
	
	err = suite.db.Create(&student2).Error
	suite.Error(err) // åº”è¯¥å¤±è´¥
	suite.Contains(err.Error(), "UNIQUE constraint failed")
}

// TestStudentSearch æµ‹è¯•å­¦ç”Ÿæœç´¢
func (suite *StudentModelTestSuite) TestStudentSearch() {
	// åˆ›å»ºæµ‹è¯•æ•°æ®
	students := []models.Student{
		{Name: "å¼ ä¸‰", Email: "zhangsan@example.com", Major: "è®¡ç®—æœºç§‘å­¦", Grade: "2023"},
		{Name: "æå››", Email: "lisi@example.com", Major: "æ•°å­¦", Grade: "2022"},
		{Name: "ç‹äº”", Email: "wangwu@example.com", Major: "è®¡ç®—æœºç§‘å­¦", Grade: "2023"},
	}
	
	for _, student := range students {
		err := suite.db.Create(&student).Error
		suite.NoError(err)
	}
	
	// æŒ‰å§“åæœç´¢
	var results []models.Student
	err := suite.db.Where("name LIKE ?", "%å¼ %").Find(&results).Error
	suite.NoError(err)
	suite.Len(results, 1)
	suite.Equal("å¼ ä¸‰", results[0].Name)
	
	// æŒ‰ä¸“ä¸šæœç´¢
	err = suite.db.Where("major = ?", "è®¡ç®—æœºç§‘å­¦").Find(&results).Error
	suite.NoError(err)
	suite.Len(results, 2)
	
	// æŒ‰å¹´çº§æœç´¢
	err = suite.db.Where("grade = ?", "2023").Find(&results).Error
	suite.NoError(err)
	suite.Len(results, 2)
}

// TestStudentTimestamps æµ‹è¯•æ—¶é—´æˆ³
func (suite *StudentModelTestSuite) TestStudentTimestamps() {
	student := models.Student{
		Name:  "æ—¶é—´æˆ³æµ‹è¯•",
		Email: "timestamp@example.com",
		Age:   20,
		Major: "è®¡ç®—æœºç§‘å­¦",
		Grade: "2023",
	}
	
	// åˆ›å»ºå‰æ—¶é—´æˆ³åº”è¯¥ä¸ºé›¶å€¼
	suite.True(student.CreatedAt.IsZero())
	suite.True(student.UpdatedAt.IsZero())
	
	// åˆ›å»ºå­¦ç”Ÿ
	err := suite.db.Create(&student).Error
	suite.NoError(err)
	
	// åˆ›å»ºåæ—¶é—´æˆ³åº”è¯¥è¢«è®¾ç½®
	suite.False(student.CreatedAt.IsZero())
	suite.False(student.UpdatedAt.IsZero())
	
	createdAt := student.CreatedAt
	updatedAt := student.UpdatedAt
	
	// ç­‰å¾…ä¸€æ¯«ç§’ç¡®ä¿æ—¶é—´å·®å¼‚
	time.Sleep(time.Millisecond)
	
	// æ›´æ–°å­¦ç”Ÿ
	student.Age = 21
	err = suite.db.Save(&student).Error
	suite.NoError(err)
	
	// åˆ›å»ºæ—¶é—´ä¸åº”è¯¥æ”¹å˜ï¼Œæ›´æ–°æ—¶é—´åº”è¯¥æ”¹å˜
	suite.Equal(createdAt, student.CreatedAt)
	suite.True(student.UpdatedAt.After(updatedAt))
}

// è¿è¡Œæµ‹è¯•å¥—ä»¶
func TestStudentModelSuite(t *testing.T) {
	suite.Run(t, new(StudentModelTestSuite))
}
```

### æ§åˆ¶å™¨æµ‹è¯•

**æ–‡ä»¶è·¯å¾„ï¼š** `tests/unit/controllers/student_controller_test.go`

```go
package controllers

import (
	"bytes"
	"encoding/json"
	"fmt"
	"net/http"
	"net/http/httptest"
	"testing"
	"strconv"

	"github.com/gin-gonic/gin"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/mock"
	"github.com/stretchr/testify/suite"
	"gorm.io/driver/sqlite"
	"gorm.io/gorm"

	"student-management/controllers"
	"student-management/models"
)

// StudentControllerTestSuite å­¦ç”Ÿæ§åˆ¶å™¨æµ‹è¯•å¥—ä»¶
type StudentControllerTestSuite struct {
	suite.Suite
	db         *gorm.DB
	router     *gin.Engine
	controller *controllers.StudentController
}

// SetupSuite è®¾ç½®æµ‹è¯•å¥—ä»¶
func (suite *StudentControllerTestSuite) SetupSuite() {
	// è®¾ç½®Ginä¸ºæµ‹è¯•æ¨¡å¼
	gin.SetMode(gin.TestMode)
	
	// åˆ›å»ºå†…å­˜æ•°æ®åº“
	db, err := gorm.Open(sqlite.Open(":memory:"), &gorm.Config{})
	suite.Require().NoError(err)
	
	// è‡ªåŠ¨è¿ç§»
	err = db.AutoMigrate(&models.Student{})
	suite.Require().NoError(err)
	
	suite.db = db
	
	// åˆ›å»ºæ§åˆ¶å™¨
	suite.controller = controllers.NewStudentController(db)
	
	// è®¾ç½®è·¯ç”±
	suite.setupRoutes()
}

// setupRoutes è®¾ç½®è·¯ç”±
func (suite *StudentControllerTestSuite) setupRoutes() {
	suite.router = gin.New()
	
	api := suite.router.Group("/api/v1")
	{
		api.GET("/students", suite.controller.GetAllStudents)
		api.GET("/students/:id", suite.controller.GetStudentByID)
		api.POST("/students", suite.controller.CreateStudent)
		api.PUT("/students/:id", suite.controller.UpdateStudent)
		api.DELETE("/students/:id", suite.controller.DeleteStudent)
		api.GET("/students/search", suite.controller.SearchStudents)
	}
}

// TearDownSuite æ¸…ç†æµ‹è¯•å¥—ä»¶
func (suite *StudentControllerTestSuite) TearDownSuite() {
	sqlDB, _ := suite.db.DB()
	sqlDB.Close()
}

// SetupTest æ¯ä¸ªæµ‹è¯•å‰çš„è®¾ç½®
func (suite *StudentControllerTestSuite) SetupTest() {
	// æ¸…ç†æ•°æ®
	suite.db.Exec("DELETE FROM students")
}

// TestGetAllStudents æµ‹è¯•è·å–æ‰€æœ‰å­¦ç”Ÿ
func (suite *StudentControllerTestSuite) TestGetAllStudents() {
	// åˆ›å»ºæµ‹è¯•æ•°æ®
	students := []models.Student{
		{Name: "å¼ ä¸‰", Email: "zhangsan@example.com", Age: 20, Major: "è®¡ç®—æœºç§‘å­¦", Grade: "2023"},
		{Name: "æå››", Email: "lisi@example.com", Age: 21, Major: "æ•°å­¦", Grade: "2022"},
	}
	
	for _, student := range students {
		suite.db.Create(&student)
	}
	
	// å‘é€è¯·æ±‚
	w := httptest.NewRecorder()
	req, _ := http.NewRequest("GET", "/api/v1/students", nil)
	suite.router.ServeHTTP(w, req)
	
	// éªŒè¯å“åº”
	suite.Equal(http.StatusOK, w.Code)
	
	var response map[string]interface{}
	err := json.Unmarshal(w.Body.Bytes(), &response)
	suite.NoError(err)
	
	suite.True(response["success"].(bool))
	data := response["data"].(map[string]interface{})
	studentList := data["students"].([]interface{})
	suite.Len(studentList, 2)
}

// TestGetStudentByID æµ‹è¯•æ ¹æ®IDè·å–å­¦ç”Ÿ
func (suite *StudentControllerTestSuite) TestGetStudentByID() {
	// åˆ›å»ºæµ‹è¯•å­¦ç”Ÿ
	student := models.Student{
		Name:  "æµ‹è¯•å­¦ç”Ÿ",
		Email: "test@example.com",
		Age:   20,
		Major: "è®¡ç®—æœºç§‘å­¦",
		Grade: "2023",
	}
	suite.db.Create(&student)
	
	// æµ‹è¯•å­˜åœ¨çš„å­¦ç”Ÿ
	w := httptest.NewRecorder()
	req, _ := http.NewRequest("GET", fmt.Sprintf("/api/v1/students/%d", student.ID), nil)
	suite.router.ServeHTTP(w, req)
	
	suite.Equal(http.StatusOK, w.Code)
	
	var response map[string]interface{}
	err := json.Unmarshal(w.Body.Bytes(), &response)
	suite.NoError(err)
	
	suite.True(response["success"].(bool))
	studentData := response["data"].(map[string]interface{})
	suite.Equal(student.Name, studentData["name"])
	
	// æµ‹è¯•ä¸å­˜åœ¨çš„å­¦ç”Ÿ
	w = httptest.NewRecorder()
	req, _ = http.NewRequest("GET", "/api/v1/students/99999", nil)
	suite.router.ServeHTTP(w, req)
	
	suite.Equal(http.StatusNotFound, w.Code)
}

// TestCreateStudent æµ‹è¯•åˆ›å»ºå­¦ç”Ÿ
func (suite *StudentControllerTestSuite) TestCreateStudent() {
	tests := []struct {
		name       string
		student    map[string]interface{}
		expectCode int
		expectErr  bool
	}{
		{
			name: "æœ‰æ•ˆçš„å­¦ç”Ÿæ•°æ®",
			student: map[string]interface{}{
				"name":  "æ–°å­¦ç”Ÿ",
				"email": "new@example.com",
				"age":   20,
				"major": "è®¡ç®—æœºç§‘å­¦",
				"grade": "2023",
			},
			expectCode: http.StatusCreated,
			expectErr:  false,
		},
		{
			name: "ç¼ºå°‘å¿…å¡«å­—æ®µ",
			student: map[string]interface{}{
				"email": "incomplete@example.com",
				"age":   20,
			},
			expectCode: http.StatusBadRequest,
			expectErr:  true,
		},
		{
			name: "æ— æ•ˆçš„é‚®ç®±æ ¼å¼",
			student: map[string]interface{}{
				"name":  "æµ‹è¯•å­¦ç”Ÿ",
				"email": "invalid-email",
				"age":   20,
				"major": "è®¡ç®—æœºç§‘å­¦",
				"grade": "2023",
			},
			expectCode: http.StatusBadRequest,
			expectErr:  true,
		},
	}
	
	for _, tt := range tests {
		suite.Run(tt.name, func() {
			body, _ := json.Marshal(tt.student)
			w := httptest.NewRecorder()
			req, _ := http.NewRequest("POST", "/api/v1/students", bytes.NewBuffer(body))
			req.Header.Set("Content-Type", "application/json")
			suite.router.ServeHTTP(w, req)
			
			suite.Equal(tt.expectCode, w.Code)
			
			var response map[string]interface{}
			err := json.Unmarshal(w.Body.Bytes(), &response)
			suite.NoError(err)
			
			if tt.expectErr {
				suite.False(response["success"].(bool))
				suite.NotEmpty(response["message"])
			} else {
				suite.True(response["success"].(bool))
				suite.NotNil(response["data"])
			}
		})
	}
}

// TestUpdateStudent æµ‹è¯•æ›´æ–°å­¦ç”Ÿ
func (suite *StudentControllerTestSuite) TestUpdateStudent() {
	// åˆ›å»ºæµ‹è¯•å­¦ç”Ÿ
	student := models.Student{
		Name:  "åŸå§‹å­¦ç”Ÿ",
		Email: "original@example.com",
		Age:   20,
		Major: "è®¡ç®—æœºç§‘å­¦",
		Grade: "2023",
	}
	suite.db.Create(&student)
	
	// æ›´æ–°æ•°æ®
	updateData := map[string]interface{}{
		"name": "æ›´æ–°åçš„å­¦ç”Ÿ",
		"age":  21,
	}
	
	body, _ := json.Marshal(updateData)
	w := httptest.NewRecorder()
	req, _ := http.NewRequest("PUT", fmt.Sprintf("/api/v1/students/%d", student.ID), bytes.NewBuffer(body))
	req.Header.Set("Content-Type", "application/json")
	suite.router.ServeHTTP(w, req)
	
	suite.Equal(http.StatusOK, w.Code)
	
	var response map[string]interface{}
	err := json.Unmarshal(w.Body.Bytes(), &response)
	suite.NoError(err)
	
	suite.True(response["success"].(bool))
	
	// éªŒè¯æ•°æ®åº“ä¸­çš„æ•°æ®å·²æ›´æ–°
	var updatedStudent models.Student
	suite.db.First(&updatedStudent, student.ID)
	suite.Equal("æ›´æ–°åçš„å­¦ç”Ÿ", updatedStudent.Name)
	suite.Equal(21, updatedStudent.Age)
	suite.Equal("original@example.com", updatedStudent.Email) // æœªæ›´æ–°çš„å­—æ®µä¿æŒä¸å˜
}

// TestDeleteStudent æµ‹è¯•åˆ é™¤å­¦ç”Ÿ
func (suite *StudentControllerTestSuite) TestDeleteStudent() {
	// åˆ›å»ºæµ‹è¯•å­¦ç”Ÿ
	student := models.Student{
		Name:  "å¾…åˆ é™¤å­¦ç”Ÿ",
		Email: "delete@example.com",
		Age:   20,
		Major: "è®¡ç®—æœºç§‘å­¦",
		Grade: "2023",
	}
	suite.db.Create(&student)
	
	// åˆ é™¤å­¦ç”Ÿ
	w := httptest.NewRecorder()
	req, _ := http.NewRequest("DELETE", fmt.Sprintf("/api/v1/students/%d", student.ID), nil)
	suite.router.ServeHTTP(w, req)
	
	suite.Equal(http.StatusOK, w.Code)
	
	var response map[string]interface{}
	err := json.Unmarshal(w.Body.Bytes(), &response)
	suite.NoError(err)
	
	suite.True(response["success"].(bool))
	
	// éªŒè¯å­¦ç”Ÿå·²è¢«è½¯åˆ é™¤
	var deletedStudent models.Student
	err = suite.db.First(&deletedStudent, student.ID).Error
	suite.Error(err) // åº”è¯¥æ‰¾ä¸åˆ°è®°å½•
	
	// éªŒè¯è½¯åˆ é™¤è®°å½•ä»å­˜åœ¨
	err = suite.db.Unscoped().First(&deletedStudent, student.ID).Error
	suite.NoError(err)
	suite.NotNil(deletedStudent.DeletedAt)
}

// TestSearchStudents æµ‹è¯•æœç´¢å­¦ç”Ÿ
func (suite *StudentControllerTestSuite) TestSearchStudents() {
	// åˆ›å»ºæµ‹è¯•æ•°æ®
	students := []models.Student{
		{Name: "å¼ ä¸‰", Email: "zhangsan@example.com", Major: "è®¡ç®—æœºç§‘å­¦", Grade: "2023"},
		{Name: "æå››", Email: "lisi@example.com", Major: "æ•°å­¦", Grade: "2022"},
		{Name: "ç‹äº”", Email: "wangwu@example.com", Major: "è®¡ç®—æœºç§‘å­¦", Grade: "2023"},
	}
	
	for _, student := range students {
		suite.db.Create(&student)
	}
	
	// æŒ‰å§“åæœç´¢
	w := httptest.NewRecorder()
	req, _ := http.NewRequest("GET", "/api/v1/students/search?name=å¼ ", nil)
	suite.router.ServeHTTP(w, req)
	
	suite.Equal(http.StatusOK, w.Code)
	
	var response map[string]interface{}
	err := json.Unmarshal(w.Body.Bytes(), &response)
	suite.NoError(err)
	
	suite.True(response["success"].(bool))
	results := response["data"].([]interface{})
	suite.Len(results, 1)
	
	// æŒ‰ä¸“ä¸šæœç´¢
	w = httptest.NewRecorder()
	req, _ = http.NewRequest("GET", "/api/v1/students/search?major=è®¡ç®—æœºç§‘å­¦", nil)
	suite.router.ServeHTTP(w, req)
	
	suite.Equal(http.StatusOK, w.Code)
	
	err = json.Unmarshal(w.Body.Bytes(), &response)
	suite.NoError(err)
	
	results = response["data"].([]interface{})
	suite.Len(results, 2)
}

// TestPagination æµ‹è¯•åˆ†é¡µ
func (suite *StudentControllerTestSuite) TestPagination() {
	// åˆ›å»º15ä¸ªæµ‹è¯•å­¦ç”Ÿ
	for i := 1; i <= 15; i++ {
		student := models.Student{
			Name:  fmt.Sprintf("å­¦ç”Ÿ%d", i),
			Email: fmt.Sprintf("student%d@example.com", i),
			Age:   20,
			Major: "è®¡ç®—æœºç§‘å­¦",
			Grade: "2023",
		}
		suite.db.Create(&student)
	}
	
	// æµ‹è¯•ç¬¬ä¸€é¡µï¼ˆé»˜è®¤æ¯é¡µ10æ¡ï¼‰
	w := httptest.NewRecorder()
	req, _ := http.NewRequest("GET", "/api/v1/students?page=1&page_size=10", nil)
	suite.router.ServeHTTP(w, req)
	
	suite.Equal(http.StatusOK, w.Code)
	
	var response map[string]interface{}
	err := json.Unmarshal(w.Body.Bytes(), &response)
	suite.NoError(err)
	
	data := response["data"].(map[string]interface{})
	students := data["students"].([]interface{})
	suite.Len(students, 10)
	suite.Equal(float64(15), data["total"])
	suite.Equal(float64(2), data["pages"])
	
	// æµ‹è¯•ç¬¬äºŒé¡µ
	w = httptest.NewRecorder()
	req, _ = http.NewRequest("GET", "/api/v1/students?page=2&page_size=10", nil)
	suite.router.ServeHTTP(w, req)
	
	suite.Equal(http.StatusOK, w.Code)
	
	err = json.Unmarshal(w.Body.Bytes(), &response)
	suite.NoError(err)
	
	data = response["data"].(map[string]interface{})
	students = data["students"].([]interface{})
	suite.Len(students, 5) // å‰©ä½™5æ¡è®°å½•
}

// è¿è¡Œæµ‹è¯•å¥—ä»¶
func TestStudentControllerSuite(t *testing.T) {
	suite.Run(t, new(StudentControllerTestSuite))
}
```

## 9.4 é›†æˆæµ‹è¯•

### APIé›†æˆæµ‹è¯•

**æ–‡ä»¶è·¯å¾„ï¼š** `tests/integration/api/student_api_test.go`

```go
package api

import (
	"bytes"
	"encoding/json"
	"fmt"
	"net/http"
	"net/http/httptest"
	"os"
	"testing"

	"github.com/gin-gonic/gin"
	"github.com/stretchr/testify/suite"
	"gorm.io/driver/sqlite"
	"gorm.io/gorm"

	"student-management/controllers"
	"student-management/models"
	"student-management/routes"
)

// StudentAPIIntegrationTestSuite APIé›†æˆæµ‹è¯•å¥—ä»¶
type StudentAPIIntegrationTestSuite struct {
	suite.Suite
	db     *gorm.DB
	server *httptest.Server
	client *http.Client
}

// SetupSuite è®¾ç½®æµ‹è¯•å¥—ä»¶
func (suite *StudentAPIIntegrationTestSuite) SetupSuite() {
	// è®¾ç½®ç¯å¢ƒå˜é‡
	os.Setenv("GIN_MODE", "test")
	
	// åˆ›å»ºæµ‹è¯•æ•°æ®åº“
	db, err := gorm.Open(sqlite.Open(":memory:"), &gorm.Config{})
	suite.Require().NoError(err)
	
	// è‡ªåŠ¨è¿ç§»
	err = db.AutoMigrate(&models.Student{})
	suite.Require().NoError(err)
	
	suite.db = db
	
	// åˆ›å»ºGinåº”ç”¨
	router := gin.New()
	router.Use(gin.Recovery())
	
	// è®¾ç½®è·¯ç”±
	routes.SetupStudentRoutes(router, db)
	
	// åˆ›å»ºæµ‹è¯•æœåŠ¡å™¨
	suite.server = httptest.NewServer(router)
	suite.client = &http.Client{}
}

// TearDownSuite æ¸…ç†æµ‹è¯•å¥—ä»¶
func (suite *StudentAPIIntegrationTestSuite) TearDownSuite() {
	suite.server.Close()
	sqlDB, _ := suite.db.DB()
	sqlDB.Close()
}

// SetupTest æ¯ä¸ªæµ‹è¯•å‰çš„è®¾ç½®
func (suite *StudentAPIIntegrationTestSuite) SetupTest() {
	// æ¸…ç†æ•°æ®
	suite.db.Exec("DELETE FROM students")
}

// TestStudentLifecycle æµ‹è¯•å­¦ç”Ÿå®Œæ•´ç”Ÿå‘½å‘¨æœŸ
func (suite *StudentAPIIntegrationTestSuite) TestStudentLifecycle() {
	// 1. åˆ›å»ºå­¦ç”Ÿ
	studentData := map[string]interface{}{
		"name":  "é›†æˆæµ‹è¯•å­¦ç”Ÿ",
		"email": "integration@example.com",
		"age":   20,
		"major": "è®¡ç®—æœºç§‘å­¦",
		"grade": "2023",
	}
	
	body, _ := json.Marshal(studentData)
	resp, err := suite.client.Post(
		suite.server.URL+"/api/v1/students",
		"application/json",
		bytes.NewBuffer(body),
	)
	suite.NoError(err)
	suite.Equal(http.StatusCreated, resp.StatusCode)
	
	var createResponse map[string]interface{}
	json.NewDecoder(resp.Body).Decode(&createResponse)
	resp.Body.Close()
	
	suite.True(createResponse["success"].(bool))
	studentID := int(createResponse["data"].(map[string]interface{})["id"].(float64))
	
	// 2. è·å–å­¦ç”Ÿè¯¦æƒ…
	resp, err = suite.client.Get(fmt.Sprintf("%s/api/v1/students/%d", suite.server.URL, studentID))
	suite.NoError(err)
	suite.Equal(http.StatusOK, resp.StatusCode)
	
	var getResponse map[string]interface{}
	json.NewDecoder(resp.Body).Decode(&getResponse)
	resp.Body.Close()
	
	suite.True(getResponse["success"].(bool))
	student := getResponse["data"].(map[string]interface{})
	suite.Equal("é›†æˆæµ‹è¯•å­¦ç”Ÿ", student["name"])
	
	// 3. æ›´æ–°å­¦ç”Ÿ
	updateData := map[string]interface{}{
		"name": "æ›´æ–°åçš„é›†æˆæµ‹è¯•å­¦ç”Ÿ",
		"age":  21,
	}
	
	body, _ = json.Marshal(updateData)
	req, _ := http.NewRequest("PUT", fmt.Sprintf("%s/api/v1/students/%d", suite.server.URL, studentID), bytes.NewBuffer(body))
	req.Header.Set("Content-Type", "application/json")
	resp, err = suite.client.Do(req)
	suite.NoError(err)
	suite.Equal(http.StatusOK, resp.StatusCode)
	resp.Body.Close()
	
	// 4. éªŒè¯æ›´æ–°
	resp, err = suite.client.Get(fmt.Sprintf("%s/api/v1/students/%d", suite.server.URL, studentID))
	suite.NoError(err)
	
	json.NewDecoder(resp.Body).Decode(&getResponse)
	resp.Body.Close()
	
	student = getResponse["data"].(map[string]interface{})
	suite.Equal("æ›´æ–°åçš„é›†æˆæµ‹è¯•å­¦ç”Ÿ", student["name"])
	suite.Equal(float64(21), student["age"])
	
	// 5. åˆ é™¤å­¦ç”Ÿ
	req, _ = http.NewRequest("DELETE", fmt.Sprintf("%s/api/v1/students/%d", suite.server.URL, studentID), nil)
	resp, err = suite.client.Do(req)
	suite.NoError(err)
	suite.Equal(http.StatusOK, resp.StatusCode)
	resp.Body.Close()
	
	// 6. éªŒè¯åˆ é™¤
	resp, err = suite.client.Get(fmt.Sprintf("%s/api/v1/students/%d", suite.server.URL, studentID))
	suite.NoError(err)
	suite.Equal(http.StatusNotFound, resp.StatusCode)
	resp.Body.Close()
}

// TestBulkOperations æµ‹è¯•æ‰¹é‡æ“ä½œ
func (suite *StudentAPIIntegrationTestSuite) TestBulkOperations() {
	// åˆ›å»ºå¤šä¸ªå­¦ç”Ÿ
	students := []map[string]interface{}{
		{"name": "æ‰¹é‡å­¦ç”Ÿ1", "email": "bulk1@example.com", "age": 20, "major": "è®¡ç®—æœºç§‘å­¦", "grade": "2023"},
		{"name": "æ‰¹é‡å­¦ç”Ÿ2", "email": "bulk2@example.com", "age": 21, "major": "æ•°å­¦", "grade": "2022"},
		{"name": "æ‰¹é‡å­¦ç”Ÿ3", "email": "bulk3@example.com", "age": 22, "major": "ç‰©ç†", "grade": "2021"},
	}
	
	var studentIDs []int
	for _, studentData := range students {
		body, _ := json.Marshal(studentData)
		resp, err := suite.client.Post(
			suite.server.URL+"/api/v1/students",
			"application/json",
			bytes.NewBuffer(body),
		)
		suite.NoError(err)
		suite.Equal(http.StatusCreated, resp.StatusCode)
		
		var response map[string]interface{}
		json.NewDecoder(resp.Body).Decode(&response)
		resp.Body.Close()
		
		studentID := int(response["data"].(map[string]interface{})["id"].(float64))
		studentIDs = append(studentIDs, studentID)
	}
	
	// è·å–æ‰€æœ‰å­¦ç”Ÿ
	resp, err := suite.client.Get(suite.server.URL + "/api/v1/students")
	suite.NoError(err)
	suite.Equal(http.StatusOK, resp.StatusCode)
	
	var listResponse map[string]interface{}
	json.NewDecoder(resp.Body).Decode(&listResponse)
	resp.Body.Close()
	
	data := listResponse["data"].(map[string]interface{})
	studentList := data["students"].([]interface{})
	suite.Len(studentList, 3)
	suite.Equal(float64(3), data["total"])
	
	// æœç´¢æµ‹è¯•
	resp, err = suite.client.Get(suite.server.URL + "/api/v1/students/search?major=è®¡ç®—æœºç§‘å­¦")
	suite.NoError(err)
	suite.Equal(http.StatusOK, resp.StatusCode)
	
	var searchResponse map[string]interface{}
	json.NewDecoder(resp.Body).Decode(&searchResponse)
	resp.Body.Close()
	
	searchResults := searchResponse["data"].([]interface{})
	suite.Len(searchResults, 1)
}

// TestErrorHandling æµ‹è¯•é”™è¯¯å¤„ç†
func (suite *StudentAPIIntegrationTestSuite) TestErrorHandling() {
	// æµ‹è¯•æ— æ•ˆçš„JSON
	resp, err := suite.client.Post(
		suite.server.URL+"/api/v1/students",
		"application/json",
		bytes.NewBuffer([]byte("invalid json")),
	)
	suite.NoError(err)
	suite.Equal(http.StatusBadRequest, resp.StatusCode)
	resp.Body.Close()
	
	// æµ‹è¯•ä¸å­˜åœ¨çš„å­¦ç”Ÿ
	resp, err = suite.client.Get(suite.server.URL + "/api/v1/students/99999")
	suite.NoError(err)
	suite.Equal(http.StatusNotFound, resp.StatusCode)
	resp.Body.Close()
	
	// æµ‹è¯•æ— æ•ˆçš„IDæ ¼å¼
	resp, err = suite.client.Get(suite.server.URL + "/api/v1/students/invalid")
	suite.NoError(err)
	suite.Equal(http.StatusBadRequest, resp.StatusCode)
	resp.Body.Close()
}

// TestConcurrentAccess æµ‹è¯•å¹¶å‘è®¿é—®
func (suite *StudentAPIIntegrationTestSuite) TestConcurrentAccess() {
	// åˆ›å»ºä¸€ä¸ªå­¦ç”Ÿç”¨äºå¹¶å‘æµ‹è¯•
	studentData := map[string]interface{}{
		"name":  "å¹¶å‘æµ‹è¯•å­¦ç”Ÿ",
		"email": "concurrent@example.com",
		"age":   20,
		"major": "è®¡ç®—æœºç§‘å­¦",
		"grade": "2023",
	}
	
	body, _ := json.Marshal(studentData)
	resp, err := suite.client.Post(
		suite.server.URL+"/api/v1/students",
		"application/json",
		bytes.NewBuffer(body),
	)
	suite.NoError(err)
	resp.Body.Close()
	
	// å¹¶å‘è¯»å–æµ‹è¯•
	done := make(chan bool, 10)
	for i := 0; i < 10; i++ {
		go func() {
			resp, err := suite.client.Get(suite.server.URL + "/api/v1/students")
			suite.NoError(err)
			suite.Equal(http.StatusOK, resp.StatusCode)
			resp.Body.Close()
			done <- true
		}()
	}
	
	// ç­‰å¾…æ‰€æœ‰goroutineå®Œæˆ
	for i := 0; i < 10; i++ {
		<-done
	}
}

// è¿è¡Œæµ‹è¯•å¥—ä»¶
func TestStudentAPIIntegrationSuite(t *testing.T) {
	suite.Run(t, new(StudentAPIIntegrationTestSuite))
}
```

## 9.5 æ€§èƒ½æµ‹è¯•

### åŸºå‡†æµ‹è¯•

**æ–‡ä»¶è·¯å¾„ï¼š** `tests/performance/benchmark_test.go`

```go
package performance

import (
	"bytes"
	"encoding/json"
	"fmt"
	"net/http"
	"net/http/httptest"
	"testing"

	"github.com/gin-gonic/gin"
	"gorm.io/driver/sqlite"
	"gorm.io/gorm"

	"student-management/controllers"
	"student-management/models"
)

// åŸºå‡†æµ‹è¯•è®¾ç½®
func setupBenchmark() (*gin.Engine, *gorm.DB) {
	gin.SetMode(gin.ReleaseMode)
	
	// åˆ›å»ºå†…å­˜æ•°æ®åº“
	db, _ := gorm.Open(sqlite.Open(":memory:"), &gorm.Config{})
	db.AutoMigrate(&models.Student{})
	
	// åˆ›å»ºè·¯ç”±
	router := gin.New()
	controller := controllers.NewStudentController(db)
	
	api := router.Group("/api/v1")
	{
		api.GET("/students", controller.GetAllStudents)
		api.GET("/students/:id", controller.GetStudentByID)
		api.POST("/students", controller.CreateStudent)
		api.PUT("/students/:id", controller.UpdateStudent)
		api.DELETE("/students/:id", controller.DeleteStudent)
		api.GET("/students/search", controller.SearchStudents)
	}
	
	return router, db
}

// åˆ›å»ºæµ‹è¯•æ•°æ®
func createTestData(db *gorm.DB, count int) {
	for i := 1; i <= count; i++ {
		student := models.Student{
			Name:  fmt.Sprintf("å­¦ç”Ÿ%d", i),
			Email: fmt.Sprintf("student%d@example.com", i),
			Age:   20 + (i % 10),
			Major: []string{"è®¡ç®—æœºç§‘å­¦", "æ•°å­¦", "ç‰©ç†", "åŒ–å­¦"}[i%4],
			Grade: fmt.Sprintf("%d", 2020+(i%4)),
		}
		db.Create(&student)
	}
}

// BenchmarkGetAllStudents åŸºå‡†æµ‹è¯•è·å–æ‰€æœ‰å­¦ç”Ÿ
func BenchmarkGetAllStudents(b *testing.B) {
	router, db := setupBenchmark()
	createTestData(db, 1000) // åˆ›å»º1000æ¡æµ‹è¯•æ•°æ®
	
	b.ResetTimer()
	b.RunParallel(func(pb *testing.PB) {
		for pb.Next() {
			w := httptest.NewRecorder()
			req, _ := http.NewRequest("GET", "/api/v1/students", nil)
			router.ServeHTTP(w, req)
			
			if w.Code != http.StatusOK {
				b.Errorf("Expected status 200, got %d", w.Code)
			}
		}
	})
}

// BenchmarkGetStudentByID åŸºå‡†æµ‹è¯•æ ¹æ®IDè·å–å­¦ç”Ÿ
func BenchmarkGetStudentByID(b *testing.B) {
	router, db := setupBenchmark()
	createTestData(db, 1000)
	
	b.ResetTimer()
	b.RunParallel(func(pb *testing.PB) {
		for pb.Next() {
			w := httptest.NewRecorder()
			req, _ := http.NewRequest("GET", "/api/v1/students/500", nil)
			router.ServeHTTP(w, req)
			
			if w.Code != http.StatusOK {
				b.Errorf("Expected status 200, got %d", w.Code)
			}
		}
	})
}

// BenchmarkCreateStudent åŸºå‡†æµ‹è¯•åˆ›å»ºå­¦ç”Ÿ
func BenchmarkCreateStudent(b *testing.B) {
	router, _ := setupBenchmark()
	
	studentData := map[string]interface{}{
		"name":  "åŸºå‡†æµ‹è¯•å­¦ç”Ÿ",
		"email": "benchmark@example.com",
		"age":   20,
		"major": "è®¡ç®—æœºç§‘å­¦",
		"grade": "2023",
	}
	
	body, _ := json.Marshal(studentData)
	
	b.ResetTimer()
	for i := 0; i < b.N; i++ {
		// ä¸ºæ¯æ¬¡æµ‹è¯•ä¿®æ”¹é‚®ç®±ä»¥é¿å…é‡å¤
		studentData["email"] = fmt.Sprintf("benchmark%d@example.com", i)
		body, _ = json.Marshal(studentData)
		
		w := httptest.NewRecorder()
		req, _ := http.NewRequest("POST", "/api/v1/students", bytes.NewBuffer(body))
		req.Header.Set("Content-Type", "application/json")
		router.ServeHTTP(w, req)
		
		if w.Code != http.StatusCreated {
			b.Errorf("Expected status 201, got %d", w.Code)
		}
	}
}

// BenchmarkSearchStudents åŸºå‡†æµ‹è¯•æœç´¢å­¦ç”Ÿ
func BenchmarkSearchStudents(b *testing.B) {
	router, db := setupBenchmark()
	createTestData(db, 1000)
	
	b.ResetTimer()
	b.RunParallel(func(pb *testing.PB) {
		for pb.Next() {
			w := httptest.NewRecorder()
			req, _ := http.NewRequest("GET", "/api/v1/students/search?name=å­¦ç”Ÿ1", nil)
			router.ServeHTTP(w, req)
			
			if w.Code != http.StatusOK {
				b.Errorf("Expected status 200, got %d", w.Code)
			}
		}
	})
}

// BenchmarkDatabaseOperations åŸºå‡†æµ‹è¯•æ•°æ®åº“æ“ä½œ
func BenchmarkDatabaseOperations(b *testing.B) {
	_, db := setupBenchmark()
	
	b.Run("Create", func(b *testing.B) {
		b.ResetTimer()
		for i := 0; i < b.N; i++ {
			student := models.Student{
				Name:  fmt.Sprintf("åŸºå‡†å­¦ç”Ÿ%d", i),
				Email: fmt.Sprintf("bench%d@example.com", i),
				Age:   20,
				Major: "è®¡ç®—æœºç§‘å­¦",
				Grade: "2023",
			}
			db.Create(&student)
		}
	})
	
	b.Run("Read", func(b *testing.B) {
		// å…ˆåˆ›å»ºä¸€äº›æ•°æ®
		createTestData(db, 100)
		
		b.ResetTimer()
		b.RunParallel(func(pb *testing.PB) {
			for pb.Next() {
				var student models.Student
				db.First(&student, 50)
			}
		})
	})
	
	b.Run("Update", func(b *testing.B) {
		// å…ˆåˆ›å»ºä¸€äº›æ•°æ®
		createTestData(db, 100)
		
		b.ResetTimer()
		for i := 0; i < b.N; i++ {
			var student models.Student
			db.First(&student, 50)
			student.Age = 25
			db.Save(&student)
		}
	})
	
	b.Run("Delete", func(b *testing.B) {
		// ä¸ºæ¯æ¬¡åˆ é™¤åˆ›å»ºæ–°æ•°æ®
		b.ResetTimer()
		for i := 0; i < b.N; i++ {
			student := models.Student{
				Name:  fmt.Sprintf("åˆ é™¤æµ‹è¯•%d", i),
				Email: fmt.Sprintf("delete%d@example.com", i),
				Age:   20,
				Major: "è®¡ç®—æœºç§‘å­¦",
				Grade: "2023",
			}
			db.Create(&student)
			db.Delete(&student)
		}
	})
}

// BenchmarkMemoryUsage å†…å­˜ä½¿ç”¨åŸºå‡†æµ‹è¯•
func BenchmarkMemoryUsage(b *testing.B) {
	router, db := setupBenchmark()
	createTestData(db, 10000) // åˆ›å»ºå¤§é‡æ•°æ®
	
	b.ResetTimer()
	b.ReportAllocs() // æŠ¥å‘Šå†…å­˜åˆ†é…
	
	for i := 0; i < b.N; i++ {
		w := httptest.NewRecorder()
		req, _ := http.NewRequest("GET", "/api/v1/students?page=1&page_size=100", nil)
		router.ServeHTTP(w, req)
	}
}
```

## 9.6 ç«¯åˆ°ç«¯æµ‹è¯•

### Playwrightæµ‹è¯•

**æ–‡ä»¶è·¯å¾„ï¼š** `tests/e2e/student_e2e_test.go`

```go
package e2e

import (
	"context"
	"testing"
	"time"

	"github.com/playwright-community/playwright-go"
	"github.com/stretchr/testify/suite"
)

// StudentE2ETestSuite ç«¯åˆ°ç«¯æµ‹è¯•å¥—ä»¶
type StudentE2ETestSuite struct {
	suite.Suite
	browser   playwright.Browser
	context   playwright.BrowserContext
	page      playwright.Page
	playwright *playwright.Playwright
	baseURL   string
}

// SetupSuite è®¾ç½®æµ‹è¯•å¥—ä»¶
func (suite *StudentE2ETestSuite) SetupSuite() {
	// å¯åŠ¨Playwright
	pw, err := playwright.Run()
	suite.Require().NoError(err)
	suite.playwright = pw
	
	// å¯åŠ¨æµè§ˆå™¨
	browser, err := pw.Chromium.Launch(playwright.BrowserTypeLaunchOptions{
		Headless: playwright.Bool(true),
	})
	suite.Require().NoError(err)
	suite.browser = browser
	
	// è®¾ç½®åŸºç¡€URL
	suite.baseURL = "http://localhost:8080"
}

// TearDownSuite æ¸…ç†æµ‹è¯•å¥—ä»¶
func (suite *StudentE2ETestSuite) TearDownSuite() {
	if suite.browser != nil {
		suite.browser.Close()
	}
	if suite.playwright != nil {
		suite.playwright.Stop()
	}
}

// SetupTest æ¯ä¸ªæµ‹è¯•å‰çš„è®¾ç½®
func (suite *StudentE2ETestSuite) SetupTest() {
	// åˆ›å»ºæ–°çš„æµè§ˆå™¨ä¸Šä¸‹æ–‡
	context, err := suite.browser.NewContext()
	suite.Require().NoError(err)
	suite.context = context
	
	// åˆ›å»ºæ–°é¡µé¢
	page, err := context.NewPage()
	suite.Require().NoError(err)
	suite.page = page
}

// TearDownTest æ¯ä¸ªæµ‹è¯•åçš„æ¸…ç†
func (suite *StudentE2ETestSuite) TearDownTest() {
	if suite.page != nil {
		suite.page.Close()
	}
	if suite.context != nil {
		suite.context.Close()
	}
}

// TestStudentManagementFlow æµ‹è¯•å­¦ç”Ÿç®¡ç†å®Œæ•´æµç¨‹
func (suite *StudentE2ETestSuite) TestStudentManagementFlow() {
	// å¯¼èˆªåˆ°å­¦ç”Ÿç®¡ç†é¡µé¢
	_, err := suite.page.Goto(suite.baseURL + "/students")
	suite.NoError(err)
	
	// ç­‰å¾…é¡µé¢åŠ è½½
	err = suite.page.WaitForSelector("#student-table", playwright.PageWaitForSelectorOptions{
		Timeout: playwright.Float(5000),
	})
	suite.NoError(err)
	
	// éªŒè¯é¡µé¢æ ‡é¢˜
	title, err := suite.page.Title()
	suite.NoError(err)
	suite.Contains(title, "å­¦ç”Ÿç®¡ç†")
	
	// ç‚¹å‡»æ·»åŠ å­¦ç”ŸæŒ‰é’®
	err = suite.page.Click("#add-student-btn")
	suite.NoError(err)
	
	// ç­‰å¾…æ¨¡æ€æ¡†å‡ºç°
	err = suite.page.WaitForSelector("#student-modal", playwright.PageWaitForSelectorOptions{
		State: playwright.WaitForSelectorStateVisible,
	})
	suite.NoError(err)
	
	// å¡«å†™å­¦ç”Ÿä¿¡æ¯
	err = suite.page.Fill("#student-name", "ç«¯åˆ°ç«¯æµ‹è¯•å­¦ç”Ÿ")
	suite.NoError(err)
	
	err = suite.page.Fill("#student-email", "e2e@example.com")
	suite.NoError(err)
	
	err = suite.page.Fill("#student-age", "20")
	suite.NoError(err)
	
	err = suite.page.SelectOption("#student-major", "è®¡ç®—æœºç§‘å­¦")
	suite.NoError(err)
	
	err = suite.page.Fill("#student-grade", "2023")
	suite.NoError(err)
	
	// æäº¤è¡¨å•
	err = suite.page.Click("#save-student-btn")
	suite.NoError(err)
	
	// ç­‰å¾…æˆåŠŸæ¶ˆæ¯
	err = suite.page.WaitForSelector(".success-message", playwright.PageWaitForSelectorOptions{
		Timeout: playwright.Float(3000),
	})
	suite.NoError(err)
	
	// éªŒè¯å­¦ç”Ÿå·²æ·»åŠ åˆ°è¡¨æ ¼ä¸­
	err = suite.page.WaitForSelector("text=ç«¯åˆ°ç«¯æµ‹è¯•å­¦ç”Ÿ", playwright.PageWaitForSelectorOptions{
		Timeout: playwright.Float(3000),
	})
	suite.NoError(err)
	
	// æµ‹è¯•æœç´¢åŠŸèƒ½
	err = suite.page.Fill("#search-input", "ç«¯åˆ°ç«¯")
	suite.NoError(err)
	
	err = suite.page.Click("#search-btn")
	suite.NoError(err)
	
	// éªŒè¯æœç´¢ç»“æœ
	time.Sleep(1 * time.Second) // ç­‰å¾…æœç´¢å®Œæˆ
	rows, err := suite.page.QuerySelectorAll("#student-table tbody tr")
	suite.NoError(err)
	suite.Len(rows, 1)
	
	// æµ‹è¯•ç¼–è¾‘åŠŸèƒ½
	err = suite.page.Click(".edit-btn")
	suite.NoError(err)
	
	err = suite.page.WaitForSelector("#student-modal", playwright.PageWaitForSelectorOptions{
		State: playwright.WaitForSelectorStateVisible,
	})
	suite.NoError(err)
	
	// ä¿®æ”¹å¹´é¾„
	err = suite.page.Fill("#student-age", "21")
	suite.NoError(err)
	
	err = suite.page.Click("#save-student-btn")
	suite.NoError(err)
	
	// éªŒè¯æ›´æ–°æˆåŠŸ
	err = suite.page.WaitForSelector(".success-message")
	suite.NoError(err)
	
	// æµ‹è¯•åˆ é™¤åŠŸèƒ½
	err = suite.page.Click(".delete-btn")
	suite.NoError(err)
	
	// ç¡®è®¤åˆ é™¤
	suite.page.OnDialog(func(dialog playwright.Dialog) {
		dialog.Accept()
	})
	
	// éªŒè¯å­¦ç”Ÿå·²è¢«åˆ é™¤
	err = suite.page.WaitForSelector("text=ç«¯åˆ°ç«¯æµ‹è¯•å­¦ç”Ÿ", playwright.PageWaitForSelectorOptions{
		State:   playwright.WaitForSelectorStateDetached,
		Timeout: playwright.Float(3000),
	})
	suite.NoError(err)
}

// TestResponsiveDesign æµ‹è¯•å“åº”å¼è®¾è®¡
func (suite *StudentE2ETestSuite) TestResponsiveDesign() {
	// æµ‹è¯•æ¡Œé¢è§†å›¾
	err := suite.page.SetViewportSize(1920, 1080)
	suite.NoError(err)
	
	_, err = suite.page.Goto(suite.baseURL + "/students")
	suite.NoError(err)
	
	// éªŒè¯æ¡Œé¢å¸ƒå±€
	isVisible, err := suite.page.IsVisible(".sidebar")
	suite.NoError(err)
	suite.True(isVisible)
	
	// æµ‹è¯•å¹³æ¿è§†å›¾
	err = suite.page.SetViewportSize(768, 1024)
	suite.NoError(err)
	
	time.Sleep(500 * time.Millisecond) // ç­‰å¾…å¸ƒå±€è°ƒæ•´
	
	// æµ‹è¯•æ‰‹æœºè§†å›¾
	err = suite.page.SetViewportSize(375, 667)
	suite.NoError(err)
	
	time.Sleep(500 * time.Millisecond)
	
	// éªŒè¯ç§»åŠ¨ç«¯å¯¼èˆª
	isVisible, err = suite.page.IsVisible(".mobile-menu-btn")
	suite.NoError(err)
	suite.True(isVisible)
}

// TestAccessibility æµ‹è¯•å¯è®¿é—®æ€§
func (suite *StudentE2ETestSuite) TestAccessibility() {
	_, err := suite.page.Goto(suite.baseURL + "/students")
	suite.NoError(err)
	
	// æµ‹è¯•é”®ç›˜å¯¼èˆª
	err = suite.page.Press("body", "Tab")
	suite.NoError(err)
	
	// éªŒè¯ç„¦ç‚¹ç®¡ç†
	focusedElement, err := suite.page.Locator(":focus").First().GetAttribute("id")
	suite.NoError(err)
	suite.NotEmpty(focusedElement)
	
	// æµ‹è¯•ARIAæ ‡ç­¾
	ariaLabel, err := suite.page.GetAttribute("#add-student-btn", "aria-label")
	suite.NoError(err)
	suite.NotEmpty(ariaLabel)
}

// è¿è¡Œæµ‹è¯•å¥—ä»¶
func TestStudentE2ESuite(t *testing.T) {
	suite.Run(t, new(StudentE2ETestSuite))
}
```

## 9.7 æµ‹è¯•å·¥å…·å’Œè„šæœ¬

### æµ‹è¯•è¿è¡Œè„šæœ¬

**æ–‡ä»¶è·¯å¾„ï¼š** `scripts/test.sh`

```bash
#!/bin/bash

# æµ‹è¯•è¿è¡Œè„šæœ¬
set -e

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# æ‰“å°å¸¦é¢œè‰²çš„æ¶ˆæ¯
print_message() {
    echo -e "${2}${1}${NC}"
}

# æ£€æŸ¥Goç¯å¢ƒ
check_go_env() {
    if ! command -v go &> /dev/null; then
        print_message "Goæœªå®‰è£…æˆ–ä¸åœ¨PATHä¸­" $RED
        exit 1
    fi
    print_message "Goç‰ˆæœ¬: $(go version)" $GREEN
}

# å®‰è£…æµ‹è¯•ä¾èµ–
install_deps() {
    print_message "å®‰è£…æµ‹è¯•ä¾èµ–..." $YELLOW
    go mod tidy
    go mod download
}

# è¿è¡Œå•å…ƒæµ‹è¯•
run_unit_tests() {
    print_message "è¿è¡Œå•å…ƒæµ‹è¯•..." $YELLOW
    go test -v -race -coverprofile=coverage/unit.out ./tests/unit/...
}

# è¿è¡Œé›†æˆæµ‹è¯•
run_integration_tests() {
    print_message "è¿è¡Œé›†æˆæµ‹è¯•..." $YELLOW
    go test -v -race -coverprofile=coverage/integration.out ./tests/integration/...
}

# è¿è¡Œæ€§èƒ½æµ‹è¯•
run_benchmark_tests() {
    print_message "è¿è¡Œæ€§èƒ½æµ‹è¯•..." $YELLOW
    go test -v -bench=. -benchmem ./tests/performance/...
}

# è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
run_e2e_tests() {
    print_message "è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•..." $YELLOW
    # å¯åŠ¨åº”ç”¨æœåŠ¡å™¨
    go run main.go &
    SERVER_PID=$!
    
    # ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨
    sleep 3
    
    # è¿è¡ŒE2Eæµ‹è¯•
    go test -v ./tests/e2e/...
    
    # åœæ­¢æœåŠ¡å™¨
    kill $SERVER_PID
}

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
generate_coverage() {
    print_message "ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š..." $YELLOW
    
    # åˆå¹¶è¦†ç›–ç‡æ–‡ä»¶
    echo "mode: atomic" > coverage/total.out
    tail -n +2 coverage/unit.out >> coverage/total.out
    tail -n +2 coverage/integration.out >> coverage/total.out
    
    # ç”ŸæˆHTMLæŠ¥å‘Š
    go tool cover -html=coverage/total.out -o coverage/coverage.html
    
    # æ˜¾ç¤ºè¦†ç›–ç‡ç»Ÿè®¡
    go tool cover -func=coverage/total.out
}

# è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥
run_quality_checks() {
    print_message "è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥..." $YELLOW
    
    # æ ¼å¼æ£€æŸ¥
    if ! gofmt -l . | grep -q .; then
        print_message "ä»£ç æ ¼å¼æ£€æŸ¥é€šè¿‡" $GREEN
    else
        print_message "ä»£ç æ ¼å¼æ£€æŸ¥å¤±è´¥" $RED
        gofmt -l .
        exit 1
    fi
    
    # é™æ€åˆ†æ
    if command -v golangci-lint &> /dev/null; then
        golangci-lint run
    else
        print_message "golangci-lintæœªå®‰è£…ï¼Œè·³è¿‡é™æ€åˆ†æ" $YELLOW
    fi
    
    # å®‰å…¨æ£€æŸ¥
    if command -v gosec &> /dev/null; then
        gosec ./...
    else
        print_message "gosecæœªå®‰è£…ï¼Œè·³è¿‡å®‰å…¨æ£€æŸ¥" $YELLOW
    fi
}

# æ¸…ç†æµ‹è¯•ç¯å¢ƒ
cleanup() {
    print_message "æ¸…ç†æµ‹è¯•ç¯å¢ƒ..." $YELLOW
    rm -f test.db
    rm -rf coverage/temp
}

# ä¸»å‡½æ•°
main() {
    print_message "å¼€å§‹è¿è¡Œæµ‹è¯•å¥—ä»¶" $GREEN
    
    # åˆ›å»ºè¦†ç›–ç‡ç›®å½•
    mkdir -p coverage
    
    # æ£€æŸ¥ç¯å¢ƒ
    check_go_env
    
    # å®‰è£…ä¾èµ–
    install_deps
    
    # æ ¹æ®å‚æ•°è¿è¡Œä¸åŒç±»å‹çš„æµ‹è¯•
    case "${1:-all}" in
        "unit")
            run_unit_tests
            ;;
        "integration")
            run_integration_tests
            ;;
        "benchmark")
            run_benchmark_tests
            ;;
        "e2e")
            run_e2e_tests
            ;;
        "quality")
            run_quality_checks
            ;;
        "all")
            run_quality_checks
            run_unit_tests
            run_integration_tests
            run_benchmark_tests
            # run_e2e_tests  # å¯é€‰ï¼Œéœ€è¦æµè§ˆå™¨ç¯å¢ƒ
            generate_coverage
            ;;
        *)
            print_message "ç”¨æ³•: $0 [unit|integration|benchmark|e2e|quality|all]" $YELLOW
            exit 1
            ;;
    esac
    
    # æ¸…ç†
    cleanup
    
    print_message "æµ‹è¯•å®Œæˆ!" $GREEN
}

# è¿è¡Œä¸»å‡½æ•°
main "$@"
```

### Makefile

**æ–‡ä»¶è·¯å¾„ï¼š** `Makefile`

```makefile
# Goå­¦ç”Ÿç®¡ç†ç³»ç»Ÿ Makefile

# å˜é‡å®šä¹‰
GO_VERSION := 1.21
APP_NAME := student-management
BUILD_DIR := build
COVERAGE_DIR := coverage
DOCS_DIR := docs

# é»˜è®¤ç›®æ ‡
.DEFAULT_GOAL := help

# å¸®åŠ©ä¿¡æ¯
.PHONY: help
help: ## æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
	@echo "å¯ç”¨çš„å‘½ä»¤:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

# ç¯å¢ƒè®¾ç½®
.PHONY: setup
setup: ## è®¾ç½®å¼€å‘ç¯å¢ƒ
	@echo "è®¾ç½®å¼€å‘ç¯å¢ƒ..."
	go mod tidy
	go mod download
	mkdir -p $(BUILD_DIR) $(COVERAGE_DIR) $(DOCS_DIR)

# ä»£ç æ ¼å¼åŒ–
.PHONY: fmt
fmt: ## æ ¼å¼åŒ–ä»£ç 
	@echo "æ ¼å¼åŒ–ä»£ç ..."
	gofmt -w .
	go mod tidy

# ä»£ç æ£€æŸ¥
.PHONY: lint
lint: ## è¿è¡Œä»£ç æ£€æŸ¥
	@echo "è¿è¡Œä»£ç æ£€æŸ¥..."
	golangci-lint run

# å®‰å…¨æ£€æŸ¥
.PHONY: security
security: ## è¿è¡Œå®‰å…¨æ£€æŸ¥
	@echo "è¿è¡Œå®‰å…¨æ£€æŸ¥..."
	gosec ./...

# å•å…ƒæµ‹è¯•
.PHONY: test-unit
test-unit: ## è¿è¡Œå•å…ƒæµ‹è¯•
	@echo "è¿è¡Œå•å…ƒæµ‹è¯•..."
	go test -v -race -coverprofile=$(COVERAGE_DIR)/unit.out ./tests/unit/...

# é›†æˆæµ‹è¯•
.PHONY: test-integration
test-integration: ## è¿è¡Œé›†æˆæµ‹è¯•
	@echo "è¿è¡Œé›†æˆæµ‹è¯•..."
	go test -v -race -coverprofile=$(COVERAGE_DIR)/integration.out ./tests/integration/...

# æ€§èƒ½æµ‹è¯•
.PHONY: test-benchmark
test-benchmark: ## è¿è¡Œæ€§èƒ½æµ‹è¯•
	@echo "è¿è¡Œæ€§èƒ½æµ‹è¯•..."
	go test -v -bench=. -benchmem ./tests/performance/...

# ç«¯åˆ°ç«¯æµ‹è¯•
.PHONY: test-e2e
test-e2e: ## è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
	@echo "è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•..."
	./scripts/test.sh e2e

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
.PHONY: test
test: ## è¿è¡Œæ‰€æœ‰æµ‹è¯•
	@echo "è¿è¡Œæ‰€æœ‰æµ‹è¯•..."
	./scripts/test.sh all

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
.PHONY: coverage
coverage: test-unit test-integration ## ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
	@echo "ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š..."
	echo "mode: atomic" > $(COVERAGE_DIR)/total.out
	tail -n +2 $(COVERAGE_DIR)/unit.out >> $(COVERAGE_DIR)/total.out
	tail -n +2 $(COVERAGE_DIR)/integration.out >> $(COVERAGE_DIR)/total.out
	go tool cover -html=$(COVERAGE_DIR)/total.out -o $(COVERAGE_DIR)/coverage.html
	go tool cover -func=$(COVERAGE_DIR)/total.out

# æ„å»ºåº”ç”¨
.PHONY: build
build: ## æ„å»ºåº”ç”¨
	@echo "æ„å»ºåº”ç”¨..."
	go build -o $(BUILD_DIR)/$(APP_NAME) .

# è¿è¡Œåº”ç”¨
.PHONY: run
run: ## è¿è¡Œåº”ç”¨
	@echo "è¿è¡Œåº”ç”¨..."
	go run main.go

# å¼€å‘æ¨¡å¼è¿è¡Œ
.PHONY: dev
dev: ## å¼€å‘æ¨¡å¼è¿è¡Œï¼ˆå¸¦çƒ­é‡è½½ï¼‰
	@echo "å¼€å‘æ¨¡å¼è¿è¡Œ..."
	air

# æ¸…ç†
.PHONY: clean
clean: ## æ¸…ç†æ„å»ºæ–‡ä»¶
	@echo "æ¸…ç†æ„å»ºæ–‡ä»¶..."
	rm -rf $(BUILD_DIR) $(COVERAGE_DIR)/*.out
	rm -f test.db

# ç”Ÿæˆæ–‡æ¡£
.PHONY: docs
docs: ## ç”ŸæˆAPIæ–‡æ¡£
	@echo "ç”ŸæˆAPIæ–‡æ¡£..."
	swag init

# Dockeræ„å»º
.PHONY: docker-build
docker-build: ## æ„å»ºDockeré•œåƒ
	@echo "æ„å»ºDockeré•œåƒ..."
	docker build -t $(APP_NAME) .

# Dockerè¿è¡Œ
.PHONY: docker-run
docker-run: ## è¿è¡ŒDockerå®¹å™¨
	@echo "è¿è¡ŒDockerå®¹å™¨..."
	docker run -p 8080:8080 $(APP_NAME)

# ä»£ç è´¨é‡æ£€æŸ¥
.PHONY: quality
quality: fmt lint security ## è¿è¡Œæ‰€æœ‰ä»£ç è´¨é‡æ£€æŸ¥

# CI/CDæµæ°´çº¿
.PHONY: ci
ci: quality test coverage ## CIæµæ°´çº¿

# å®‰è£…å·¥å…·
.PHONY: install-tools
install-tools: ## å®‰è£…å¼€å‘å·¥å…·
	@echo "å®‰è£…å¼€å‘å·¥å…·..."
	go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
	go install github.com/securecodewarrior/gosec/v2/cmd/gosec@latest
	go install github.com/swaggo/swag/cmd/swag@latest
	go install github.com/cosmtrek/air@latest
```

## 9.8 æŒç»­é›†æˆé…ç½®

### GitHub Actions

**æ–‡ä»¶è·¯å¾„ï¼š** `.github/workflows/test.yml`

```yaml
name: æµ‹è¯•æµæ°´çº¿

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        go-version: [1.20, 1.21]
    
    steps:
    - uses: actions/checkout@v3
    
    - name: è®¾ç½®Goç¯å¢ƒ
      uses: actions/setup-go@v3
      with:
        go-version: ${{ matrix.go-version }}
    
    - name: ç¼“å­˜Goæ¨¡å—
      uses: actions/cache@v3
      with:
        path: ~/go/pkg/mod
        key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
        restore-keys: |
          ${{ runner.os }}-go-
    
    - name: å®‰è£…ä¾èµ–
      run: |
        go mod tidy
        go mod download
    
    - name: ä»£ç æ ¼å¼æ£€æŸ¥
      run: |
        if [ "$(gofmt -s -l . | wc -l)" -gt 0 ]; then
          echo "ä»£ç æ ¼å¼ä¸æ­£ç¡®:"
          gofmt -s -l .
          exit 1
        fi
    
    - name: å®‰è£…golangci-lint
      run: |
        curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.54.2
    
    - name: è¿è¡Œä»£ç æ£€æŸ¥
      run: golangci-lint run
    
    - name: è¿è¡Œå•å…ƒæµ‹è¯•
      run: |
        mkdir -p coverage
        go test -v -race -coverprofile=coverage/unit.out ./tests/unit/...
    
    - name: è¿è¡Œé›†æˆæµ‹è¯•
      run: |
        go test -v -race -coverprofile=coverage/integration.out ./tests/integration/...
    
    - name: ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
      run: |
        echo "mode: atomic" > coverage/total.out
        tail -n +2 coverage/unit.out >> coverage/total.out
        tail -n +2 coverage/integration.out >> coverage/total.out
        go tool cover -func=coverage/total.out
    
    - name: ä¸Šä¼ è¦†ç›–ç‡åˆ°Codecov
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage/total.out
        flags: unittests
        name: codecov-umbrella
    
    - name: æ„å»ºåº”ç”¨
      run: go build -v .
```

## 9.9 æµ‹è¯•æœ€ä½³å®è·µ

### æµ‹è¯•åŸåˆ™

1. **æµ‹è¯•é‡‘å­—å¡”** - å¤§é‡å•å…ƒæµ‹è¯•ï¼Œé€‚é‡é›†æˆæµ‹è¯•ï¼Œå°‘é‡E2Eæµ‹è¯•
2. **å¿«é€Ÿåé¦ˆ** - æµ‹è¯•åº”è¯¥å¿«é€Ÿè¿è¡Œå¹¶æä¾›å³æ—¶åé¦ˆ
3. **ç‹¬ç«‹æ€§** - æµ‹è¯•ä¹‹é—´åº”è¯¥ç›¸äº’ç‹¬ç«‹
4. **å¯é‡å¤æ€§** - æµ‹è¯•ç»“æœåº”è¯¥ä¸€è‡´å’Œå¯é‡å¤
5. **å¯ç»´æŠ¤æ€§** - æµ‹è¯•ä»£ç åº”è¯¥æ˜“äºç†è§£å’Œç»´æŠ¤

### å‘½åçº¦å®š

```go
// æµ‹è¯•å‡½æ•°å‘½åï¼šTest + åŠŸèƒ½åç§° + åœºæ™¯
func TestCreateStudent_ValidData_Success(t *testing.T) {}
func TestCreateStudent_InvalidEmail_ReturnsError(t *testing.T) {}
func TestCreateStudent_DuplicateEmail_ReturnsError(t *testing.T) {}

// åŸºå‡†æµ‹è¯•å‘½åï¼šBenchmark + åŠŸèƒ½åç§°
func BenchmarkGetAllStudents(b *testing.B) {}
func BenchmarkCreateStudent(b *testing.B) {}
```

### æµ‹è¯•æ•°æ®ç®¡ç†

```go
// ä½¿ç”¨å·¥å‚å‡½æ•°åˆ›å»ºæµ‹è¯•æ•°æ®
func createTestStudent(overrides ...func(*models.Student)) models.Student {
	student := models.Student{
		Name:  "æµ‹è¯•å­¦ç”Ÿ",
		Email: "test@example.com",
		Age:   20,
		Major: "è®¡ç®—æœºç§‘å­¦",
		Grade: "2023",
	}
	
	for _, override := range overrides {
		override(&student)
	}
	
	return student
}

// ä½¿ç”¨ç¤ºä¾‹
student := createTestStudent(func(s *models.Student) {
	s.Age = 25
	s.Major = "æ•°å­¦"
})
```

### é”™è¯¯å¤„ç†æµ‹è¯•

```go
func TestCreateStudent_DatabaseError_ReturnsError(t *testing.T) {
	// æ¨¡æ‹Ÿæ•°æ®åº“é”™è¯¯
	mockDB := &MockDB{}
	mockDB.On("Create", mock.Anything).Return(errors.New("database error"))
	
	controller := NewStudentController(mockDB)
	
	// æµ‹è¯•é”™è¯¯å¤„ç†
	err := controller.CreateStudent(validStudentData)
	assert.Error(t, err)
	assert.Contains(t, err.Error(), "database error")
}
```

## 9.10 æ€»ç»“

æœ¬ç« è¯¦ç»†ä»‹ç»äº†Goå­¦ç”Ÿç®¡ç†ç³»ç»Ÿçš„æµ‹è¯•ç­–ç•¥å’Œå®ç°ï¼š

### æ ¸å¿ƒç‰¹æ€§

- âœ… **å®Œæ•´çš„æµ‹è¯•è¦†ç›–** - å•å…ƒã€é›†æˆã€æ€§èƒ½ã€E2Eæµ‹è¯•
- ğŸ”§ **è‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿** - CI/CDé›†æˆ
- ğŸ“Š **è¦†ç›–ç‡æŠ¥å‘Š** - è¯¦ç»†çš„æµ‹è¯•è¦†ç›–ç‡åˆ†æ
- ğŸš€ **æ€§èƒ½åŸºå‡†æµ‹è¯•** - ç³»ç»Ÿæ€§èƒ½ç›‘æ§
- ğŸ­ **ç«¯åˆ°ç«¯æµ‹è¯•** - å®Œæ•´ç”¨æˆ·æµç¨‹éªŒè¯
- ğŸ›¡ï¸ **ä»£ç è´¨é‡æ£€æŸ¥** - é™æ€åˆ†æå’Œå®‰å…¨æ£€æŸ¥

### æœ€ä½³å®è·µ

1. **æµ‹è¯•é©±åŠ¨å¼€å‘** - å…ˆå†™æµ‹è¯•ï¼Œå†å†™å®ç°
2. **æŒç»­é›†æˆ** - æ¯æ¬¡æäº¤éƒ½è¿è¡Œæµ‹è¯•
3. **æµ‹è¯•æ•°æ®éš”ç¦»** - æ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®
4. **æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–** - ä½¿ç”¨Mockå¯¹è±¡éš”ç¦»æµ‹è¯•
5. **æ€§èƒ½ç›‘æ§** - å®šæœŸè¿è¡ŒåŸºå‡†æµ‹è¯•
6. **æ–‡æ¡£åŒ–æµ‹è¯•** - æµ‹è¯•å³æ–‡æ¡£

é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œä½ å°†æŒæ¡å¦‚ä½•æ„å»ºä¸€ä¸ªå¥å£®ã€å¯é çš„æµ‹è¯•ä½“ç³»ï¼Œç¡®ä¿ç³»ç»Ÿçš„è´¨é‡å’Œç¨³å®šæ€§ã€‚