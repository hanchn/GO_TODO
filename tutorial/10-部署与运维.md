# ç¬¬10ç« ï¼šéƒ¨ç½²ä¸è¿ç»´

æœ¬ç« å°†è¯¦ç»†ä»‹ç»å¦‚ä½•å°†Goå­¦ç”Ÿç®¡ç†ç³»ç»Ÿéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼ŒåŒ…æ‹¬å®¹å™¨åŒ–éƒ¨ç½²ã€äº‘å¹³å°éƒ¨ç½²ã€ç›‘æ§å‘Šè­¦ã€æ—¥å¿—ç®¡ç†å’Œè¿ç»´è‡ªåŠ¨åŒ–ã€‚

## 10.1 éƒ¨ç½²ç­–ç•¥

### éƒ¨ç½²æ–¹å¼å¯¹æ¯”

| éƒ¨ç½²æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|----------|
| ğŸ–¥ï¸ **ä¼ ç»Ÿéƒ¨ç½²** | ç®€å•ç›´æ¥ï¼Œèµ„æºåˆ©ç”¨ç‡é«˜ | ç¯å¢ƒä¾èµ–ï¼Œæ‰©å±•å›°éš¾ | å°å‹é¡¹ç›®ï¼Œå•æœºéƒ¨ç½² |
| ğŸ³ **å®¹å™¨åŒ–éƒ¨ç½²** | ç¯å¢ƒä¸€è‡´ï¼Œæ˜“äºæ‰©å±• | å­¦ä¹ æˆæœ¬ï¼Œèµ„æºå¼€é”€ | ä¸­å¤§å‹é¡¹ç›®ï¼Œå¾®æœåŠ¡ |
| â˜ï¸ **äº‘å¹³å°éƒ¨ç½²** | å¼¹æ€§ä¼¸ç¼©ï¼Œé«˜å¯ç”¨ | æˆæœ¬è¾ƒé«˜ï¼Œå‚å•†ç»‘å®š | ä¼ä¸šçº§åº”ç”¨ |
| ğŸš€ **Serverless** | æŒ‰éœ€ä»˜è´¹ï¼Œè‡ªåŠ¨æ‰©å±• | å†·å¯åŠ¨ï¼ŒåŠŸèƒ½é™åˆ¶ | è½»é‡çº§åº”ç”¨ï¼Œäº‹ä»¶é©±åŠ¨ |

### éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è´Ÿè½½å‡è¡¡å™¨ (Nginx/ALB)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚             â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ Appå®ä¾‹1 â”‚   â”‚ Appå®ä¾‹2 â”‚   â”‚ Appå®ä¾‹3 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   æ•°æ®åº“é›†ç¾¤   â”‚
              â”‚ (MySQL/Redis) â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 10.2 å®¹å™¨åŒ–éƒ¨ç½²

### Dockerfile

**æ–‡ä»¶è·¯å¾„ï¼š** `Dockerfile`

```dockerfile
# å¤šé˜¶æ®µæ„å»º
# ç¬¬ä¸€é˜¶æ®µï¼šæ„å»ºé˜¶æ®µ
FROM golang:1.21-alpine AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£…å¿…è¦çš„åŒ…
RUN apk add --no-cache git ca-certificates tzdata

# å¤åˆ¶go modæ–‡ä»¶
COPY go.mod go.sum ./

# ä¸‹è½½ä¾èµ–
RUN go mod download

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .

# ç¬¬äºŒé˜¶æ®µï¼šè¿è¡Œé˜¶æ®µ
FROM alpine:latest

# å®‰è£…caè¯ä¹¦å’Œæ—¶åŒºæ•°æ®
RUN apk --no-cache add ca-certificates tzdata

# è®¾ç½®æ—¶åŒº
ENV TZ=Asia/Shanghai

# åˆ›å»ºérootç”¨æˆ·
RUN addgroup -g 1001 appgroup && \
    adduser -D -s /bin/sh -u 1001 -G appgroup appuser

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶
COPY --from=builder /app/main .

# å¤åˆ¶é™æ€æ–‡ä»¶
COPY --from=builder /app/static ./static
COPY --from=builder /app/templates ./templates

# åˆ›å»ºæ•°æ®ç›®å½•
RUN mkdir -p /app/data && chown -R appuser:appgroup /app

# åˆ‡æ¢åˆ°érootç”¨æˆ·
USER appuser

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD wget --no-verbose --tries=1 --spider http://localhost:8080/health || exit 1

# å¯åŠ¨åº”ç”¨
CMD ["./main"]
```

### Docker Compose

**æ–‡ä»¶è·¯å¾„ï¼š** `docker-compose.yml`

```yaml
version: '3.8'

services:
  # åº”ç”¨æœåŠ¡
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: student-management-app
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      - GIN_MODE=release
      - DATABASE_URL=mysql://root:password@db:3306/student_management?charset=utf8mb4&parseTime=True&loc=Local
      - REDIS_URL=redis://redis:6379/0
      - LOG_LEVEL=info
    depends_on:
      - db
      - redis
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    networks:
      - app-network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # æ•°æ®åº“æœåŠ¡
  db:
    image: mysql:8.0
    container_name: student-management-db
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: student_management
      MYSQL_USER: app_user
      MYSQL_PASSWORD: app_password
    ports:
      - "3306:3306"
    volumes:
      - db_data:/var/lib/mysql
      - ./scripts/init.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - app-network
    command: --default-authentication-plugin=mysql_native_password

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: student-management-redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - app-network
    command: redis-server --appendonly yes

  # Nginxåå‘ä»£ç†
  nginx:
    image: nginx:alpine
    container_name: student-management-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
      - ./logs/nginx:/var/log/nginx
    depends_on:
      - app
    networks:
      - app-network

  # ç›‘æ§æœåŠ¡
  prometheus:
    image: prom/prometheus:latest
    container_name: student-management-prometheus
    restart: unless-stopped
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    networks:
      - app-network
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'
      - '--storage.tsdb.retention.time=200h'
      - '--web.enable-lifecycle'

  # å¯è§†åŒ–ç›‘æ§
  grafana:
    image: grafana/grafana:latest
    container_name: student-management-grafana
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin123
    volumes:
      - grafana_data:/var/lib/grafana
      - ./monitoring/grafana/dashboards:/etc/grafana/provisioning/dashboards
      - ./monitoring/grafana/datasources:/etc/grafana/provisioning/datasources
    networks:
      - app-network

volumes:
  db_data:
  redis_data:
  prometheus_data:
  grafana_data:

networks:
  app-network:
    driver: bridge
```

### Nginxé…ç½®

**æ–‡ä»¶è·¯å¾„ï¼š** `nginx/nginx.conf`

```nginx
events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    # æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for" '
                    'rt=$request_time uct="$upstream_connect_time" '
                    'uht="$upstream_header_time" urt="$upstream_response_time"';

    access_log /var/log/nginx/access.log main;
    error_log /var/log/nginx/error.log warn;

    # åŸºæœ¬è®¾ç½®
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    client_max_body_size 10M;

    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/json
        application/javascript
        application/xml+rss
        application/atom+xml
        image/svg+xml;

    # ä¸Šæ¸¸æœåŠ¡å™¨
    upstream app_backend {
        least_conn;
        server app:8080 max_fails=3 fail_timeout=30s;
        # å¯ä»¥æ·»åŠ æ›´å¤šå®ä¾‹
        # server app2:8080 max_fails=3 fail_timeout=30s;
        # server app3:8080 max_fails=3 fail_timeout=30s;
    }

    # é™æµé…ç½®
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
    limit_req_zone $binary_remote_addr zone=login:10m rate=1r/s;

    # HTTPæœåŠ¡å™¨
    server {
        listen 80;
        server_name localhost;

        # é‡å®šå‘åˆ°HTTPS
        # return 301 https://$server_name$request_uri;

        # å¥åº·æ£€æŸ¥
        location /health {
            access_log off;
            proxy_pass http://app_backend/health;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # APIæ¥å£
        location /api/ {
            limit_req zone=api burst=20 nodelay;
            
            proxy_pass http://app_backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # è¶…æ—¶è®¾ç½®
            proxy_connect_timeout 30s;
            proxy_send_timeout 30s;
            proxy_read_timeout 30s;
            
            # ç¼“å­˜è®¾ç½®
            proxy_buffering on;
            proxy_buffer_size 4k;
            proxy_buffers 8 4k;
        }

        # ç™»å½•æ¥å£ç‰¹æ®Šé™æµ
        location /api/v1/auth/login {
            limit_req zone=login burst=5 nodelay;
            
            proxy_pass http://app_backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # é™æ€æ–‡ä»¶
        location /static/ {
            expires 1y;
            add_header Cache-Control "public, immutable";
            proxy_pass http://app_backend;
        }

        # å‰ç«¯é¡µé¢
        location / {
            proxy_pass http://app_backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # é”™è¯¯é¡µé¢
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root /usr/share/nginx/html;
        }
    }

    # HTTPSæœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰
    # server {
    #     listen 443 ssl http2;
    #     server_name localhost;
    #
    #     ssl_certificate /etc/nginx/ssl/cert.pem;
    #     ssl_certificate_key /etc/nginx/ssl/key.pem;
    #     ssl_session_timeout 1d;
    #     ssl_session_cache shared:SSL:50m;
    #     ssl_session_tickets off;
    #
    #     ssl_protocols TLSv1.2 TLSv1.3;
    #     ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    #     ssl_prefer_server_ciphers off;
    #
    #     add_header Strict-Transport-Security "max-age=63072000" always;
    #
    #     # å…¶ä»–é…ç½®ä¸HTTPç›¸åŒ
    # }
}
```

## 10.3 Kuberneteséƒ¨ç½²

### å‘½åç©ºé—´

**æ–‡ä»¶è·¯å¾„ï¼š** `k8s/namespace.yaml`

```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: student-management
  labels:
    name: student-management
    environment: production
```

### ConfigMapé…ç½®

**æ–‡ä»¶è·¯å¾„ï¼š** `k8s/configmap.yaml`

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: student-management
data:
  GIN_MODE: "release"
  LOG_LEVEL: "info"
  DATABASE_HOST: "mysql-service"
  DATABASE_PORT: "3306"
  DATABASE_NAME: "student_management"
  REDIS_HOST: "redis-service"
  REDIS_PORT: "6379"
  REDIS_DB: "0"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  namespace: student-management
data:
  nginx.conf: |
    events {
        worker_connections 1024;
    }
    http {
        upstream app_backend {
            server app-service:8080;
        }
        server {
            listen 80;
            location / {
                proxy_pass http://app_backend;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            }
        }
    }
```

### Secreté…ç½®

**æ–‡ä»¶è·¯å¾„ï¼š** `k8s/secret.yaml`

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: app-secrets
  namespace: student-management
type: Opaque
data:
  # base64ç¼–ç çš„å¯†ç 
  DATABASE_PASSWORD: cGFzc3dvcmQ=  # password
  DATABASE_USER: YXBwX3VzZXI=      # app_user
  JWT_SECRET: bXlfc2VjcmV0X2tleQ==  # my_secret_key
---
apiVersion: v1
kind: Secret
metadata:
  name: mysql-secret
  namespace: student-management
type: Opaque
data:
  MYSQL_ROOT_PASSWORD: cGFzc3dvcmQ=  # password
  MYSQL_PASSWORD: YXBwX3Bhc3N3b3Jk      # app_password
```

### MySQLéƒ¨ç½²

**æ–‡ä»¶è·¯å¾„ï¼š** `k8s/mysql.yaml`

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql
  namespace: student-management
spec:
  serviceName: mysql-service
  replicas: 1
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: mysql:8.0
        ports:
        - containerPort: 3306
        env:
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_ROOT_PASSWORD
        - name: MYSQL_DATABASE
          value: "student_management"
        - name: MYSQL_USER
          value: "app_user"
        - name: MYSQL_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_PASSWORD
        volumeMounts:
        - name: mysql-storage
          mountPath: /var/lib/mysql
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          exec:
            command:
            - mysqladmin
            - ping
            - -h
            - localhost
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          exec:
            command:
            - mysql
            - -h
            - localhost
            - -u
            - root
            - -p$MYSQL_ROOT_PASSWORD
            - -e
            - "SELECT 1"
          initialDelaySeconds: 5
          periodSeconds: 2
  volumeClaimTemplates:
  - metadata:
      name: mysql-storage
    spec:
      accessModes: ["ReadWriteOnce"]
      resources:
        requests:
          storage: 10Gi
---
apiVersion: v1
kind: Service
metadata:
  name: mysql-service
  namespace: student-management
spec:
  selector:
    app: mysql
  ports:
  - port: 3306
    targetPort: 3306
  clusterIP: None
```

### Rediséƒ¨ç½²

**æ–‡ä»¶è·¯å¾„ï¼š** `k8s/redis.yaml`

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis
  namespace: student-management
spec:
  replicas: 1
  selector:
    matchLabels:
      app: redis
  template:
    metadata:
      labels:
        app: redis
    spec:
      containers:
      - name: redis
        image: redis:7-alpine
        ports:
        - containerPort: 6379
        command: ["redis-server", "--appendonly", "yes"]
        volumeMounts:
        - name: redis-storage
          mountPath: /data
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "200m"
        livenessProbe:
          exec:
            command:
            - redis-cli
            - ping
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          exec:
            command:
            - redis-cli
            - ping
          initialDelaySeconds: 5
          periodSeconds: 2
      volumes:
      - name: redis-storage
        persistentVolumeClaim:
          claimName: redis-pvc
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: redis-pvc
  namespace: student-management
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
---
apiVersion: v1
kind: Service
metadata:
  name: redis-service
  namespace: student-management
spec:
  selector:
    app: redis
  ports:
  - port: 6379
    targetPort: 6379
```

### åº”ç”¨éƒ¨ç½²

**æ–‡ä»¶è·¯å¾„ï¼š** `k8s/app.yaml`

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: student-management-app
  namespace: student-management
  labels:
    app: student-management
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
  selector:
    matchLabels:
      app: student-management
  template:
    metadata:
      labels:
        app: student-management
    spec:
      containers:
      - name: app
        image: student-management:latest
        ports:
        - containerPort: 8080
        env:
        - name: GIN_MODE
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: GIN_MODE
        - name: LOG_LEVEL
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: LOG_LEVEL
        - name: DATABASE_URL
          value: "mysql://$(DATABASE_USER):$(DATABASE_PASSWORD)@$(DATABASE_HOST):$(DATABASE_PORT)/$(DATABASE_NAME)?charset=utf8mb4&parseTime=True&loc=Local"
        - name: DATABASE_HOST
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: DATABASE_HOST
        - name: DATABASE_PORT
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: DATABASE_PORT
        - name: DATABASE_NAME
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: DATABASE_NAME
        - name: DATABASE_USER
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: DATABASE_USER
        - name: DATABASE_PASSWORD
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: DATABASE_PASSWORD
        - name: REDIS_URL
          value: "redis://$(REDIS_HOST):$(REDIS_PORT)/$(REDIS_DB)"
        - name: REDIS_HOST
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: REDIS_HOST
        - name: REDIS_PORT
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: REDIS_PORT
        - name: REDIS_DB
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: REDIS_DB
        - name: JWT_SECRET
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: JWT_SECRET
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        readinessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 3
        volumeMounts:
        - name: app-logs
          mountPath: /app/logs
      volumes:
      - name: app-logs
        emptyDir: {}
---
apiVersion: v1
kind: Service
metadata:
  name: app-service
  namespace: student-management
spec:
  selector:
    app: student-management
  ports:
  - port: 8080
    targetPort: 8080
  type: ClusterIP
```

### Ingressé…ç½®

**æ–‡ä»¶è·¯å¾„ï¼š** `k8s/ingress.yaml`

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: student-management-ingress
  namespace: student-management
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/rate-limit-window: "1m"
spec:
  ingressClassName: nginx
  rules:
  - host: student-management.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: app-service
            port:
              number: 8080
  # TLSé…ç½®ï¼ˆå¯é€‰ï¼‰
  # tls:
  # - hosts:
  #   - student-management.local
  #   secretName: tls-secret
```

### HPAè‡ªåŠ¨æ‰©ç¼©å®¹

**æ–‡ä»¶è·¯å¾„ï¼š** `k8s/hpa.yaml`

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: student-management-hpa
  namespace: student-management
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: student-management-app
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 10
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60
      - type: Pods
        value: 2
        periodSeconds: 60
      selectPolicy: Max
```

## 10.4 ç›‘æ§ä¸å‘Šè­¦

### Prometheusé…ç½®

**æ–‡ä»¶è·¯å¾„ï¼š** `monitoring/prometheus.yml`

```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "alert_rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

scrape_configs:
  # Prometheusè‡ªèº«ç›‘æ§
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # åº”ç”¨ç›‘æ§
  - job_name: 'student-management'
    static_configs:
      - targets: ['app:8080']
    metrics_path: '/metrics'
    scrape_interval: 10s

  # Node Exporter
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']

  # MySQLç›‘æ§
  - job_name: 'mysql-exporter'
    static_configs:
      - targets: ['mysql-exporter:9104']

  # Redisç›‘æ§
  - job_name: 'redis-exporter'
    static_configs:
      - targets: ['redis-exporter:9121']

  # Nginxç›‘æ§
  - job_name: 'nginx-exporter'
    static_configs:
      - targets: ['nginx-exporter:9113']
```

### å‘Šè­¦è§„åˆ™

**æ–‡ä»¶è·¯å¾„ï¼š** `monitoring/alert_rules.yml`

```yaml
groups:
- name: student-management-alerts
  rules:
  # åº”ç”¨å¥åº·æ£€æŸ¥
  - alert: ApplicationDown
    expr: up{job="student-management"} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "åº”ç”¨æœåŠ¡ä¸å¯ç”¨"
      description: "å­¦ç”Ÿç®¡ç†ç³»ç»Ÿå·²ç»åœæ­¢å“åº”è¶…è¿‡1åˆ†é’Ÿ"

  # é«˜é”™è¯¯ç‡
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.1
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "é«˜é”™è¯¯ç‡æ£€æµ‹"
      description: "5xxé”™è¯¯ç‡è¶…è¿‡10%ï¼Œå½“å‰å€¼: {{ $value }}"

  # é«˜å“åº”æ—¶é—´
  - alert: HighResponseTime
    expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 1
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "å“åº”æ—¶é—´è¿‡é•¿"
      description: "95%çš„è¯·æ±‚å“åº”æ—¶é—´è¶…è¿‡1ç§’ï¼Œå½“å‰å€¼: {{ $value }}s"

  # CPUä½¿ç”¨ç‡è¿‡é«˜
  - alert: HighCPUUsage
    expr: rate(process_cpu_seconds_total[5m]) * 100 > 80
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "CPUä½¿ç”¨ç‡è¿‡é«˜"
      description: "CPUä½¿ç”¨ç‡è¶…è¿‡80%ï¼Œå½“å‰å€¼: {{ $value }}%"

  # å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜
  - alert: HighMemoryUsage
    expr: (process_resident_memory_bytes / 1024 / 1024) > 500
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
      description: "å†…å­˜ä½¿ç”¨è¶…è¿‡500MBï¼Œå½“å‰å€¼: {{ $value }}MB"

  # æ•°æ®åº“è¿æ¥æ•°è¿‡é«˜
  - alert: HighDatabaseConnections
    expr: mysql_global_status_threads_connected > 50
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "æ•°æ®åº“è¿æ¥æ•°è¿‡é«˜"
      description: "MySQLè¿æ¥æ•°è¶…è¿‡50ï¼Œå½“å‰å€¼: {{ $value }}"

  # ç£ç›˜ç©ºé—´ä¸è¶³
  - alert: DiskSpaceLow
    expr: (node_filesystem_avail_bytes / node_filesystem_size_bytes) * 100 < 10
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "ç£ç›˜ç©ºé—´ä¸è¶³"
      description: "ç£ç›˜å¯ç”¨ç©ºé—´å°‘äº10%ï¼Œå½“å‰å€¼: {{ $value }}%"
```

### Grafanaä»ªè¡¨æ¿

**æ–‡ä»¶è·¯å¾„ï¼š** `monitoring/grafana/dashboards/app-dashboard.json`

```json
{
  "dashboard": {
    "id": null,
    "title": "å­¦ç”Ÿç®¡ç†ç³»ç»Ÿç›‘æ§",
    "tags": ["student-management"],
    "timezone": "browser",
    "panels": [
      {
        "id": 1,
        "title": "è¯·æ±‚æ€»æ•°",
        "type": "stat",
        "targets": [
          {
            "expr": "sum(rate(http_requests_total[5m]))",
            "legendFormat": "RPS"
          }
        ],
        "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0}
      },
      {
        "id": 2,
        "title": "é”™è¯¯ç‡",
        "type": "stat",
        "targets": [
          {
            "expr": "sum(rate(http_requests_total{status=~\"5..\"}[5m])) / sum(rate(http_requests_total[5m])) * 100",
            "legendFormat": "Error Rate %"
          }
        ],
        "gridPos": {"h": 8, "w": 6, "x": 6, "y": 0}
      },
      {
        "id": 3,
        "title": "å“åº”æ—¶é—´",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.50, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "50th percentile"
          },
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "95th percentile"
          },
          {
            "expr": "histogram_quantile(0.99, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "99th percentile"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
      },
      {
        "id": 4,
        "title": "CPUä½¿ç”¨ç‡",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(process_cpu_seconds_total[5m]) * 100",
            "legendFormat": "CPU Usage %"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
      },
      {
        "id": 5,
        "title": "å†…å­˜ä½¿ç”¨",
        "type": "graph",
        "targets": [
          {
            "expr": "process_resident_memory_bytes / 1024 / 1024",
            "legendFormat": "Memory Usage MB"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
      }
    ],
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "refresh": "5s"
  }
}
```

## 10.5 æ—¥å¿—ç®¡ç†

### ç»“æ„åŒ–æ—¥å¿—

**æ–‡ä»¶è·¯å¾„ï¼š** `utils/logger.go`

```go
package utils

import (
	"os"
	"time"

	"github.com/sirupsen/logrus"
	"gopkg.in/natefinch/lumberjack.v2"
)

// Logger å…¨å±€æ—¥å¿—å®ä¾‹
var Logger *logrus.Logger

// LogConfig æ—¥å¿—é…ç½®
type LogConfig struct {
	Level      string `json:"level"`
	Format     string `json:"format"`
	Output     string `json:"output"`
	Filename   string `json:"filename"`
	MaxSize    int    `json:"max_size"`
	MaxBackups int    `json:"max_backups"`
	MaxAge     int    `json:"max_age"`
	Compress   bool   `json:"compress"`
}

// InitLogger åˆå§‹åŒ–æ—¥å¿—
func InitLogger(config LogConfig) {
	Logger = logrus.New()
	
	// è®¾ç½®æ—¥å¿—çº§åˆ«
	level, err := logrus.ParseLevel(config.Level)
	if err != nil {
		level = logrus.InfoLevel
	}
	Logger.SetLevel(level)
	
	// è®¾ç½®æ—¥å¿—æ ¼å¼
	if config.Format == "json" {
		Logger.SetFormatter(&logrus.JSONFormatter{
			TimestampFormat: time.RFC3339,
			FieldMap: logrus.FieldMap{
				logrus.FieldKeyTime:  "timestamp",
				logrus.FieldKeyLevel: "level",
				logrus.FieldKeyMsg:   "message",
			},
		})
	} else {
		Logger.SetFormatter(&logrus.TextFormatter{
			FullTimestamp:   true,
			TimestampFormat: "2006-01-02 15:04:05",
		})
	}
	
	// è®¾ç½®è¾“å‡º
	if config.Output == "file" && config.Filename != "" {
		// æ–‡ä»¶è¾“å‡ºï¼Œæ”¯æŒæ—¥å¿—è½®è½¬
		Logger.SetOutput(&lumberjack.Logger{
			Filename:   config.Filename,
			MaxSize:    config.MaxSize,    // MB
			MaxBackups: config.MaxBackups,
			MaxAge:     config.MaxAge,     // days
			Compress:   config.Compress,
		})
	} else {
		// æ ‡å‡†è¾“å‡º
		Logger.SetOutput(os.Stdout)
	}
	
	// æ·»åŠ é’©å­
	Logger.AddHook(&ContextHook{})
}

// ContextHook ä¸Šä¸‹æ–‡é’©å­
type ContextHook struct{}

// Levels è¿”å›æ”¯æŒçš„æ—¥å¿—çº§åˆ«
func (hook *ContextHook) Levels() []logrus.Level {
	return logrus.AllLevels
}

// Fire æ‰§è¡Œé’©å­
func (hook *ContextHook) Fire(entry *logrus.Entry) error {
	// æ·»åŠ æœåŠ¡ä¿¡æ¯
	entry.Data["service"] = "student-management"
	entry.Data["version"] = "1.0.0"
	
	// æ·»åŠ ä¸»æœºä¿¡æ¯
	if hostname, err := os.Hostname(); err == nil {
		entry.Data["hostname"] = hostname
	}
	
	return nil
}

// WithFields åˆ›å»ºå¸¦å­—æ®µçš„æ—¥å¿—æ¡ç›®
func WithFields(fields logrus.Fields) *logrus.Entry {
	return Logger.WithFields(fields)
}

// WithError åˆ›å»ºå¸¦é”™è¯¯çš„æ—¥å¿—æ¡ç›®
func WithError(err error) *logrus.Entry {
	return Logger.WithError(err)
}

// Info ä¿¡æ¯æ—¥å¿—
func Info(args ...interface{}) {
	Logger.Info(args...)
}

// Warn è­¦å‘Šæ—¥å¿—
func Warn(args ...interface{}) {
	Logger.Warn(args...)
}

// Error é”™è¯¯æ—¥å¿—
func Error(args ...interface{}) {
	Logger.Error(args...)
}

// Fatal è‡´å‘½é”™è¯¯æ—¥å¿—
func Fatal(args ...interface{}) {
	Logger.Fatal(args...)
}

// Debug è°ƒè¯•æ—¥å¿—
func Debug(args ...interface{}) {
	Logger.Debug(args...)
}
```

### ELK Stacké…ç½®

**æ–‡ä»¶è·¯å¾„ï¼š** `logging/filebeat.yml`

```yaml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /app/logs/*.log
  fields:
    service: student-management
    environment: production
  fields_under_root: true
  multiline.pattern: '^\d{4}-\d{2}-\d{2}'
  multiline.negate: true
  multiline.match: after

processors:
- add_host_metadata:
    when.not.contains.tags: forwarded
- add_docker_metadata: ~
- add_kubernetes_metadata: ~

output.elasticsearch:
  hosts: ["elasticsearch:9200"]
  index: "student-management-%{+yyyy.MM.dd}"
  template.name: "student-management"
  template.pattern: "student-management-*"
  template.settings:
    index.number_of_shards: 1
    index.number_of_replicas: 1

logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644
```

## 10.6 éƒ¨ç½²è„šæœ¬

### éƒ¨ç½²è„šæœ¬

**æ–‡ä»¶è·¯å¾„ï¼š** `scripts/deploy.sh`

```bash
#!/bin/bash

# éƒ¨ç½²è„šæœ¬
set -e

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# é…ç½®å˜é‡
APP_NAME="student-management"
IMAGE_NAME="$APP_NAME"
CONTAINER_NAME="$APP_NAME-app"
DOCKER_REGISTRY="your-registry.com"
ENVIRONMENT="${ENVIRONMENT:-production}"
VERSION="${VERSION:-latest}"

# æ‰“å°å¸¦é¢œè‰²çš„æ¶ˆæ¯
print_message() {
    echo -e "${2}${1}${NC}"
}

# æ£€æŸ¥ä¾èµ–
check_dependencies() {
    print_message "æ£€æŸ¥éƒ¨ç½²ä¾èµ–..." $YELLOW
    
    if ! command -v docker &> /dev/null; then
        print_message "Dockeræœªå®‰è£…" $RED
        exit 1
    fi
    
    if ! command -v docker-compose &> /dev/null; then
        print_message "Docker Composeæœªå®‰è£…" $RED
        exit 1
    fi
    
    print_message "ä¾èµ–æ£€æŸ¥é€šè¿‡" $GREEN
}

# æ„å»ºé•œåƒ
build_image() {
    print_message "æ„å»ºDockeré•œåƒ..." $YELLOW
    
    # æ„å»ºé•œåƒ
    docker build -t $IMAGE_NAME:$VERSION .
    
    # æ ‡è®°ä¸ºlatest
    if [ "$VERSION" != "latest" ]; then
        docker tag $IMAGE_NAME:$VERSION $IMAGE_NAME:latest
    fi
    
    print_message "é•œåƒæ„å»ºå®Œæˆ: $IMAGE_NAME:$VERSION" $GREEN
}

# æ¨é€é•œåƒåˆ°ä»“åº“
push_image() {
    if [ -n "$DOCKER_REGISTRY" ] && [ "$DOCKER_REGISTRY" != "your-registry.com" ]; then
        print_message "æ¨é€é•œåƒåˆ°ä»“åº“..." $YELLOW
        
        # æ ‡è®°é•œåƒ
        docker tag $IMAGE_NAME:$VERSION $DOCKER_REGISTRY/$IMAGE_NAME:$VERSION
        docker tag $IMAGE_NAME:latest $DOCKER_REGISTRY/$IMAGE_NAME:latest
        
        # æ¨é€é•œåƒ
        docker push $DOCKER_REGISTRY/$IMAGE_NAME:$VERSION
        docker push $DOCKER_REGISTRY/$IMAGE_NAME:latest
        
        print_message "é•œåƒæ¨é€å®Œæˆ" $GREEN
    else
        print_message "è·³è¿‡é•œåƒæ¨é€ï¼ˆæœ¬åœ°éƒ¨ç½²ï¼‰" $YELLOW
    fi
}

# Docker Composeéƒ¨ç½²
deploy_docker_compose() {
    print_message "ä½¿ç”¨Docker Composeéƒ¨ç½²..." $YELLOW
    
    # åœæ­¢ç°æœ‰æœåŠ¡
    docker-compose down
    
    # å¯åŠ¨æœåŠ¡
    docker-compose up -d
    
    # ç­‰å¾…æœåŠ¡å¯åŠ¨
    print_message "ç­‰å¾…æœåŠ¡å¯åŠ¨..." $YELLOW
    sleep 10
    
    # æ£€æŸ¥æœåŠ¡çŠ¶æ€
    if docker-compose ps | grep -q "Up"; then
        print_message "æœåŠ¡å¯åŠ¨æˆåŠŸ" $GREEN
    else
        print_message "æœåŠ¡å¯åŠ¨å¤±è´¥" $RED
        docker-compose logs
        exit 1
    fi
}

# Kuberneteséƒ¨ç½²
deploy_kubernetes() {
    print_message "ä½¿ç”¨Kuberneteséƒ¨ç½²..." $YELLOW
    
    # æ£€æŸ¥kubectl
    if ! command -v kubectl &> /dev/null; then
        print_message "kubectlæœªå®‰è£…" $RED
        exit 1
    fi
    
    # åº”ç”¨é…ç½®
    kubectl apply -f k8s/namespace.yaml
    kubectl apply -f k8s/configmap.yaml
    kubectl apply -f k8s/secret.yaml
    kubectl apply -f k8s/mysql.yaml
    kubectl apply -f k8s/redis.yaml
    kubectl apply -f k8s/app.yaml
    kubectl apply -f k8s/ingress.yaml
    kubectl apply -f k8s/hpa.yaml
    
    # ç­‰å¾…éƒ¨ç½²å®Œæˆ
    print_message "ç­‰å¾…Podå¯åŠ¨..." $YELLOW
    kubectl wait --for=condition=ready pod -l app=student-management -n student-management --timeout=300s
    
    # æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
    kubectl get pods -n student-management
    
    print_message "Kuberneteséƒ¨ç½²å®Œæˆ" $GREEN
}

# å¥åº·æ£€æŸ¥
health_check() {
    print_message "æ‰§è¡Œå¥åº·æ£€æŸ¥..." $YELLOW
    
    local max_attempts=30
    local attempt=1
    local health_url="http://localhost:8080/health"
    
    while [ $attempt -le $max_attempts ]; do
        if curl -f -s $health_url > /dev/null; then
            print_message "å¥åº·æ£€æŸ¥é€šè¿‡" $GREEN
            return 0
        fi
        
        print_message "å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œé‡è¯• $attempt/$max_attempts" $YELLOW
        sleep 5
        ((attempt++))
    done
    
    print_message "å¥åº·æ£€æŸ¥å¤±è´¥" $RED
    return 1
}

# å›æ»š
rollback() {
    print_message "æ‰§è¡Œå›æ»š..." $YELLOW
    
    if [ "$DEPLOY_METHOD" = "kubernetes" ]; then
        kubectl rollout undo deployment/student-management-app -n student-management
        kubectl rollout status deployment/student-management-app -n student-management
    else
        # Docker Composeå›æ»š
        docker-compose down
        docker-compose up -d
    fi
    
    print_message "å›æ»šå®Œæˆ" $GREEN
}

# æ¸…ç†æ—§é•œåƒ
cleanup() {
    print_message "æ¸…ç†æ—§é•œåƒ..." $YELLOW
    
    # åˆ é™¤æ‚¬ç©ºé•œåƒ
    docker image prune -f
    
    # åˆ é™¤æ—§ç‰ˆæœ¬é•œåƒï¼ˆä¿ç•™æœ€è¿‘3ä¸ªç‰ˆæœ¬ï¼‰
    docker images $IMAGE_NAME --format "table {{.Tag}}\t{{.ID}}" | \
        tail -n +2 | head -n -3 | awk '{print $2}' | \
        xargs -r docker rmi
    
    print_message "æ¸…ç†å®Œæˆ" $GREEN
}

# æ˜¾ç¤ºå¸®åŠ©
show_help() {
    echo "ç”¨æ³•: $0 [é€‰é¡¹] [å‘½ä»¤]"
    echo ""
    echo "å‘½ä»¤:"
    echo "  build     æ„å»ºé•œåƒ"
    echo "  deploy    éƒ¨ç½²åº”ç”¨"
    echo "  rollback  å›æ»šéƒ¨ç½²"
    echo "  health    å¥åº·æ£€æŸ¥"
    echo "  cleanup   æ¸…ç†èµ„æº"
    echo ""
    echo "é€‰é¡¹:"
    echo "  -e, --env ENVIRONMENT    è®¾ç½®ç¯å¢ƒ (é»˜è®¤: production)"
    echo "  -v, --version VERSION    è®¾ç½®ç‰ˆæœ¬ (é»˜è®¤: latest)"
    echo "  -m, --method METHOD      éƒ¨ç½²æ–¹æ³• (docker-compose|kubernetes)"
    echo "  -h, --help              æ˜¾ç¤ºå¸®åŠ©"
    echo ""
    echo "ç¯å¢ƒå˜é‡:"
    echo "  ENVIRONMENT             éƒ¨ç½²ç¯å¢ƒ"
    echo "  VERSION                 åº”ç”¨ç‰ˆæœ¬"
    echo "  DEPLOY_METHOD           éƒ¨ç½²æ–¹æ³•"
    echo "  DOCKER_REGISTRY         Dockerä»“åº“åœ°å€"
}

# ä¸»å‡½æ•°
main() {
    local command=""
    local deploy_method="${DEPLOY_METHOD:-docker-compose}"
    
    # è§£æå‚æ•°
    while [[ $# -gt 0 ]]; do
        case $1 in
            -e|--env)
                ENVIRONMENT="$2"
                shift 2
                ;;
            -v|--version)
                VERSION="$2"
                shift 2
                ;;
            -m|--method)
                deploy_method="$2"
                shift 2
                ;;
            -h|--help)
                show_help
                exit 0
                ;;
            build|deploy|rollback|health|cleanup)
                command="$1"
                shift
                ;;
            *)
                print_message "æœªçŸ¥å‚æ•°: $1" $RED
                show_help
                exit 1
                ;;
        esac
    done
    
    # å¦‚æœæ²¡æœ‰æŒ‡å®šå‘½ä»¤ï¼Œé»˜è®¤ä¸ºdeploy
    if [ -z "$command" ]; then
        command="deploy"
    fi
    
    print_message "å¼€å§‹éƒ¨ç½² $APP_NAME" $BLUE
    print_message "ç¯å¢ƒ: $ENVIRONMENT" $BLUE
    print_message "ç‰ˆæœ¬: $VERSION" $BLUE
    print_message "éƒ¨ç½²æ–¹æ³•: $deploy_method" $BLUE
    
    # æ‰§è¡Œå‘½ä»¤
    case $command in
        build)
            check_dependencies
            build_image
            push_image
            ;;
        deploy)
            check_dependencies
            build_image
            push_image
            
            if [ "$deploy_method" = "kubernetes" ]; then
                deploy_kubernetes
            else
                deploy_docker_compose
            fi
            
            health_check || {
                print_message "éƒ¨ç½²å¤±è´¥ï¼Œæ‰§è¡Œå›æ»š" $RED
                rollback
                exit 1
            }
            
            cleanup
            print_message "éƒ¨ç½²æˆåŠŸ!" $GREEN
            ;;
        rollback)
            rollback
            ;;
        health)
            health_check
            ;;
        cleanup)
            cleanup
            ;;
        *)
            print_message "æœªçŸ¥å‘½ä»¤: $command" $RED
            show_help
            exit 1
            ;;
    esac
}

# è¿è¡Œä¸»å‡½æ•°
main "$@"
```

## 10.7 æ€»ç»“

æœ¬ç« è¯¦ç»†ä»‹ç»äº†Goå­¦ç”Ÿç®¡ç†ç³»ç»Ÿçš„éƒ¨ç½²ä¸è¿ç»´ï¼š

### æ ¸å¿ƒç‰¹æ€§

- ğŸ³ **å®¹å™¨åŒ–éƒ¨ç½²** - Dockerå’ŒDocker Composeæ”¯æŒ
- â˜¸ï¸ **Kuberneteséƒ¨ç½²** - ç”Ÿäº§çº§å®¹å™¨ç¼–æ’
- ğŸ“Š **ç›‘æ§å‘Šè­¦** - Prometheus + Grafanaç›‘æ§ä½“ç³»
- ğŸ“ **æ—¥å¿—ç®¡ç†** - ç»“æ„åŒ–æ—¥å¿—å’ŒELK Stack
- ğŸš€ **è‡ªåŠ¨åŒ–éƒ¨ç½²** - CI/CDæµæ°´çº¿å’Œéƒ¨ç½²è„šæœ¬
- ğŸ”„ **å¼¹æ€§ä¼¸ç¼©** - HPAè‡ªåŠ¨æ‰©ç¼©å®¹
- ğŸ›¡ï¸ **é«˜å¯ç”¨æ€§** - è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»

### æœ€ä½³å®è·µ

1. **åŸºç¡€è®¾æ–½å³ä»£ç ** - æ‰€æœ‰é…ç½®æ–‡ä»¶åŒ–ç®¡ç†
2. **æ¸è¿›å¼éƒ¨ç½²** - è“ç»¿éƒ¨ç½²å’Œæ»šåŠ¨æ›´æ–°
3. **ç›‘æ§é©±åŠ¨** - å…¨é¢çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»
4. **æ—¥å¿—èšåˆ** - é›†ä¸­åŒ–æ—¥å¿—ç®¡ç†
5. **è‡ªåŠ¨åŒ–è¿ç»´** - å‡å°‘äººå·¥å¹²é¢„
6. **å®‰å…¨åŠ å›º** - æœ€å°æƒé™åŸåˆ™

é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œä½ å°†æŒæ¡å¦‚ä½•å°†Goåº”ç”¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œå¹¶å»ºç«‹å®Œå–„çš„è¿ç»´ä½“ç³»ã€‚